# Fork-ID ê¸°ìˆ  ì‹¬í™” ë¶„ì„: ë¡œì§, ì„¤ê³„, ê·¸ë¦¬ê³  êµ¬í˜„

  

## ëª©ì°¨

1. [í•µì‹¬ ê°œë… ë° ìš©ì–´](#í•µì‹¬-ê°œë…-ë°-ìš©ì–´)

2. [Fork-ID ì„¤ê³„ì˜ ê¸°ì›ê³¼ ì² í•™](#fork-id-ì„¤ê³„ì˜-ê¸°ì›ê³¼-ì² í•™)

3. [CRC32 ì„ íƒì˜ ê¸°ìˆ ì  ë°°ê²½](#crc32-ì„ íƒì˜-ê¸°ìˆ ì -ë°°ê²½)

4. [PoW ì‹œëŒ€: ë¸”ë¡ ê¸°ë°˜ ë™ê¸°í™”](#pow-ì‹œëŒ€-ë¸”ë¡-ê¸°ë°˜-ë™ê¸°í™”)

5. [PoS ì „í™˜: The Mergeì™€ ê¸°ìˆ ì  ë³€í™”](#pos-ì „í™˜-the-mergeì™€-ê¸°ìˆ ì -ë³€í™”)

6. [ê³ ì • ë¸”ë¡ íƒ€ì„ì˜ ì˜ë¯¸](#ê³ ì •-ë¸”ë¡-íƒ€ì„ì˜-ì˜ë¯¸)

7. [í…ŒìŠ¤íŠ¸ë„· ì„¤ê³„ ì² í•™](#í…ŒìŠ¤íŠ¸ë„·-ì„¤ê³„-ì² í•™)

8. [Mainnet ì—­ì‚¬ì™€ í¬í¬ ìˆœì„œ](#mainnet-ì—­ì‚¬ì™€-í¬í¬-ìˆœì„œ)

9. [í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„¤ê³„ ì›ë¦¬](#í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤-ì„¤ê³„-ì›ë¦¬)

10. [ì‹¤ì œ êµ¬í˜„: 0ìœ¼ë¡œ ì„¤ì •ëœ ë¸”ë¡ì˜ ì¸ì‹](#ì‹¤ì œ-êµ¬í˜„-0ìœ¼ë¡œ-ì„¤ì •ëœ-ë¸”ë¡ì˜-ì¸ì‹)

11. [Mainnet í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œ](#mainnet-í…ŒìŠ¤íŠ¸-ì‘ì„±-ê°€ì´ë“œ)

  

---

  

## í•µì‹¬ ê°œë… ë° ìš©ì–´

  

### ENR (Ethereum Node Record)

  

**ì •ì˜:**

Ethereum Node RecordëŠ” P2P ë„¤íŠ¸ì›Œí¬ì—ì„œ ë…¸ë“œë¥¼ ì‹ë³„í•˜ê³  ì •ë³´ë¥¼ ê³µìœ í•˜ê¸° ìœ„í•œ í‘œì¤€ í¬ë§·ì…ë‹ˆë‹¤.

  

**êµ¬ì¡°:**

```

ENR v4 (Ethereum Node Record Version 4)

â”œâ”€ Node ID (ê³µê°œí‚¤ ê¸°ë°˜) : ~40 bytes

â”œâ”€ IP ì£¼ì†Œ : ~8 bytes

â”œâ”€ í¬íŠ¸ : 4 bytes

â”œâ”€ Fork-ID (EIP-2124 ì´í›„) : 12 bytes

â”œâ”€ SeqNum (ì‹œí€€ìŠ¤ ë²ˆí˜¸) : 8 bytes

â”œâ”€ ê¸°íƒ€ ë©”íƒ€ë°ì´í„° : ~100 bytes

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì´ í¬ê¸° ì œí•œ: 300 bytes

```

  

**ì—­í• :**

ENRì€ DHT (Distributed Hash Table)ì™€ Bootnodesì—ì„œ ì‚¬ìš©ë˜ì–´ í”¼ì–´ ë°œê²¬ì„ ë•ìŠµë‹ˆë‹¤. Fork-IDê°€ ENRì— í¬í•¨ë˜ë¯€ë¡œ, ë…¸ë“œë¥¼ ë°œê²¬í•  ë•Œ TCP ì—°ê²° ì „ì— í˜¸í™˜ì„±ì„ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  

**ì˜ˆì‹œ:**

```

Mainnet ë…¸ë“œì˜ ENR

enr:-LK4QIjvU...

  

ë””ì½”ë”© í›„:

Node ID: a3f5d...

IP: 192.168.1.100

Port: 30303

fork-id: [0x1d4e2e7f, 1681338455]

```

  

---

  

### Peer Slot (í”¼ì–´ ìŠ¬ë¡¯)

  

**ì •ì˜:**

ê° ë…¸ë“œëŠ” ë™ì‹œì— ì—°ê²°í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ í”¼ì–´ ìˆ˜ë¥¼ ì œí•œí•©ë‹ˆë‹¤. ì´ë¥¼ "í”¼ì–´ ìŠ¬ë¡¯"ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

P2P Connection ê³„ì¸µ (eth í”„ë¡œí† ì½œ)ì—ì„œ ì´ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

  

**ì™œ í•„ìš”í•œê°€:**

```

1. ë¦¬ì†ŒìŠ¤ ì œí•œ

- ê° ì—°ê²°ë§ˆë‹¤ ë©”ëª¨ë¦¬, CPU, ëŒ€ì—­í­ ì†Œë¹„

- ë¬´ì œí•œ ì—°ê²° ë¶ˆê°€ëŠ¥

- ì¼ë°˜ì ìœ¼ë¡œ: ìµœëŒ€ 50~100 í”¼ì–´

  

2. ë„¤íŠ¸ì›Œí¬ ì•ˆì •ì„±

- ê³¼ë„í•œ ì—°ê²° ì‹œ ë…¸ë“œ ì„±ëŠ¥ ì €í•˜

- DOS ê³µê²© ë°©ì§€

- ì–‘ì§ˆì˜ í”¼ì–´ì— ì§‘ì¤‘

  

3. Fork-ID ì—­í• 

- í˜¸í™˜ë˜ì§€ ì•ŠëŠ” í”¼ì–´ëŠ” ìŠ¬ë¡¯ ë‚­ë¹„

- Fork-IDë¡œ ì¡°ê¸° í•„í„°ë§í•˜ì—¬ ì¢‹ì€ í”¼ì–´ ìš°ì„  ì—°ê²°

```

  

**ì˜ˆì‹œ:**

```

ë…¸ë“œ A: ìµœëŒ€ 50 í”¼ì–´ ìŠ¬ë¡¯

â”œâ”€ ì—°ê²°ëœ í˜¸í™˜ í”¼ì–´ 40ê°œ

â”œâ”€ í˜¸í™˜ ë¶ˆê°€ëŠ¥í•œ í”¼ì–´ 0ê°œ (Fork-IDë¡œ í•„í„°ë¨)

â””â”€ ë‚¨ì€ ìŠ¬ë¡¯ 10ê°œ

  

Fork-ID ì—†ì´:

â”œâ”€ ì—°ê²°ëœ í˜¸í™˜ í”¼ì–´ 30ê°œ

â”œâ”€ í˜¸í™˜ ë¶ˆê°€ëŠ¥í•œ í”¼ì–´ 15ê°œ (ë‚­ë¹„)

â””â”€ ë‚¨ì€ ìŠ¬ë¡¯ 5ê°œ (ì¢‹ì€ í”¼ì–´ ì°¾ê¸° ì–´ë ¤ì›€)

```

  

---

  

### Difficulty Bomb (Ice Age)

  

**ì •ì˜:**

Ethereumì˜ ì±„êµ´ ë‚œì´ë„ë¥¼ ì ì§„ì ìœ¼ë¡œ ì¦ê°€ì‹œí‚¤ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

  

**ì‘ë™ ì›ë¦¬:**

```

ë¸”ë¡ ë²ˆí˜¸ì— ë”°ë¼ ë‚œì´ë„ ì§€ìˆ˜ì  ì¦ê°€:

  

difficulty = base_difficulty + 2^((block_number - ice_age_start) / 100000)

  

íŠ¹ì§•:

- ì´ˆê¸°: ê±°ì˜ ì˜í–¥ ì—†ìŒ

- ì‹œê°„ ê²½ê³¼: ë‚œì´ë„ ë¹ ë¥´ê²Œ ì¦ê°€

- ê²°ê³¼: ì±„êµ´ìë“¤ì´ Merge ì¤€ë¹„í•˜ë„ë¡ ê°•ì œ

```

  

**ì—­ì‚¬:**

```

ë„ì…: Homestead (ë¸”ë¡ 1,150,000)

ëª©ì : PoSë¡œ ì „í™˜í•  ì¤€ë¹„ ì‹œê°„ ì œê³µ

  

ì¬ì—°ê¸° (Delay):

- Muir Glacier (ë¸”ë¡ 9,200,000): 500ë§Œ ë¸”ë¡ ì—°ê¸°

- Arrow Glacier (ë¸”ë¡ 13,773,000): 1000ë§Œ ë¸”ë¡ ì—°ê¸°

- Gray Glacier (ë¸”ë¡ 15,050,000): ìµœí›„ì˜ ì—°ê¸°

- Merge (ë¸”ë¡ 17,034,870): ì™„ì „íˆ ì œê±° (PoS ì‹œì‘)

```

  

**The Merge í›„:**

PoSëŠ” ë‚œì´ë„ í­íƒ„ì´ ì—†ìœ¼ë¯€ë¡œ, ë…¸ë“œ ìš´ì˜ìë“¤ì´ ì†Œí”„íŠ¸ì›¨ì–´ ì—…ê·¸ë ˆì´ë“œí•  ì—¬ìœ ê°€ ìˆìŠµë‹ˆë‹¤.

  

---

  

**Ethereumì—ì„œì˜ ZK-SNARK ì ìš© (Byzantium í¬í¬, ë¸”ë¡ 4,370,000):**

  

```

ì¶”ê°€ëœ precompile ê³„ì•½:

â”œâ”€ 0x06: EC ì  ì¶”ê°€ (Elliptic Curve Addition)

â”œâ”€ 0x07: EC ìŠ¤ì¹¼ë¼ ê³±ì…ˆ (EC Scalar Multiplication)

â””â”€ 0x08: Pairing ê²€ì¦ (Pairing Check)

  

ì´ ê¸°ëŠ¥ë“¤ì€ zk-SNARK ê²€ì¦ì— í•„ìš”í•œ ì—°ì‚°

```

  

---

  

## Fork-ID ì„¤ê³„ì˜ ê¸°ì›ê³¼ ì² í•™

  

### EIP-2124ì˜ ë°°ê²½

  

**ì¶œì²˜:** [EIP-2124: Fork identifier for chain compatibility checks](https://eips.ethereum.org/EIPS/eip-2124)

**ì œì•ˆì:** Peter Szilagyi (go-ethereum core dev)

**ìƒíƒœ:** Final

  

#### ì‹¤ì œ ë¬¸ì œ ìƒí™©

  

EIP-2124 ìŠ¤í™ì—ì„œ ì§ì ‘ ì¸ìš©í•œ ë¬¸ì œ:

  

> "nodes in the Ethereum network try to find each other by establishing random connections... hoping that they found a useful peer (same genesis, same forks)"

  

ë” êµ¬ì²´ì ì¸ ì„¤ëª…:

  

> "establish a TCP/IP connection, wrap it with RLPx cryptography, then execute an `eth` handshake"

  

#### EIP-2124 ì´ì „: í•¸ë“œì…°ì´í¬ê¹Œì§€ ì§„í–‰í•´ì•¼ ì²´ì¸ ì •ë³´ í™•ì¸

  

**EIP-2124 ì´ì „ì˜ ë¬¸ì œ:**

```

1. TCP/IP ì—°ê²° ìˆ˜ë¦½

2. RLPx ì•”í˜¸í™” ë˜í•‘

3. eth í•¸ë“œì…°ì´í¬ ì‹œì‘

4. Status ë©”ì‹œì§€ êµí™˜

â”œâ”€ ProtocolVersion í™•ì¸

â”œâ”€ NetworkID í™•ì¸ (ì´ê²ƒë§Œìœ¼ë¡œ í˜¸í™˜ì„± íŒë‹¨)

â””â”€ Genesis í•´ì‹œ í™•ì¸

5. ë‹¤ë¥¸ ì²´ì¸ì´ë©´ ì—°ê²° ì¢…ë£Œ

  

ë¬¸ì œ: NetworkIDë§Œìœ¼ë¡œëŠ” êµ¬ë¶„ ë¶ˆê°€!

- Mainnet ID = 1

- Ethereum Classic ID = 61

- Sepolia ID = 11155111

â†’ ê°™ì€ ì œë„¤ì‹œìŠ¤ë¥¼ ê³µìœ í•˜ëŠ” í¬í¬ëŠ” êµ¬ë¶„ ë¶ˆê°€ëŠ¥

â†’ ê° í•˜ë“œí¬í¬ë§ˆë‹¤ ìƒˆë¡œìš´ êµ¬ë¶„ ê¸°ì¤€ í•„ìš”

```

  

**Go-ethereumì˜ ì‹¤ì œ í•¸ë“œì…°ì´í¬ ì½”ë“œ:**

```go

// eth/protocols/eth/handshake.go

// í”¼ì–´ì™€ì˜ í•¸ë“œì…°ì´í¬ í”„ë¡œí† ì½œ ìˆ˜í–‰ (í”„ë¡œí† ì½œ ë²„ì „ì— ë”°ë¼ ë¶„ê¸°)

func (p *Peer) Handshake(networkID uint64, chain forkid.Blockchain,

rangeMsg BlockRangeUpdatePacket) error {

// í”„ë¡œí† ì½œ ë²„ì „ì— ë”°ë¼ ë‹¤ë¥¸ í•¸ë“œì…°ì´í¬ ë¡œì§ ì‹¤í–‰

switch p.version {

// ETH/69: ìµœì‹  í”„ë¡œí† ì½œ (ë¸”ë¡ ë²”ìœ„ ì •ë³´ ì¶”ê°€)

case ETH69:

return p.handshake69(networkID, chain, rangeMsg)

// ETH/68: EIP-2124 Fork-IDë¥¼ ì²˜ìŒ ë„ì…í•œ ë²„ì „

case ETH68:

return p.handshake68(networkID, chain)

// ì§€ì›í•˜ì§€ ì•ŠëŠ” í”„ë¡œí† ì½œ ë²„ì „

default:

return errors.New("unsupported protocol version")

}

}

  

// Status ë©”ì‹œì§€ êµ¬ì¡° (ETH68 - EIP-2124 ë„ì… í›„)

type StatusPacket68 struct {

ProtocolVersion uint32 // ETH í”„ë¡œí† ì½œ ë²„ì „ (68)

NetworkID uint64 // ë„¤íŠ¸ì›Œí¬ êµ¬ë¶„ì (ë©”ì¸ë„·=1, Goerli=5, Sepolia=11155111 ë“±)

Head common.Hash // ë¡œì»¬ ìµœì‹  ë¸”ë¡ í•´ì‹œ (í˜„ì¬ ë™ê¸°í™” ìƒíƒœ)

Genesis common.Hash // ì œë„¤ì‹œìŠ¤ ë¸”ë¡ í•´ì‹œ (ì²´ì¸ ê²€ì¦ìš©)

ForkID forkid.ID // â† Fork-ID (EIP-2124 ì¶”ê°€) [fork_hash(4byte) + fork_next(8byte)]

}

```

  
  

**ì˜ˆì‹œ: Ethereum vs Ethereum Classic (DAO Fork)**

```

DAO Fork ì´í›„:

- Ethereum (ì±„íƒ): networkID=1, ë¸”ë¡ 1,920,000 ì´í›„ ê·œì¹™ ë³€ê²½

- Ethereum Classic (ê±°ë¶€): networkID=61, ê¸°ì¡´ ê·œì¹™ ìœ ì§€

  

ë¬¸ì œ:

- Ethereum ë…¸ë“œ: ë¸”ë¡ 1,920,000 ì´í›„ë¥¼ ê¸°ëŒ€

- Ethereum Classic ë…¸ë“œ: ë¸”ë¡ 1,920,000 ì´í›„ë„ ê¸°ì¡´ ê·œì¹™ ì ìš©

  

networkIDë§Œìœ¼ë¡œëŠ” êµ¬ë¶„ë˜ì§€ë§Œ,

Ethereum Classicì´ networkIDë¥¼ ë³€ê²½í•˜ì§€ ì•Šìœ¼ë©´?

â†’ ì™„ì „íˆ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë¸”ë¡ë“¤ì´ êµí™˜ë  ìˆ˜ ìˆìŒ

```

  

**ì´ê²ƒì´ ë¬¸ì œì¸ ì´ìœ :**

```

í˜„ì¬ í”„ë¡œì„¸ìŠ¤ (ë¹„íš¨ìœ¨ì ):

1. TCP/IP ì—°ê²° êµ¬ì„± (ì‹œê°„ ì†Œìš”)

2. RLPx ì•”í˜¸í™” ì ìš© (ì•”í˜¸í™” ì˜¤ë²„í—¤ë“œ)

3. eth í•¸ë“œì…°ì´í¬ ì‹¤í–‰ (ë„¤íŠ¸ì›Œí¬ ë¼ìš´ë“œ íŠ¸ë¦½)

4. Status ë©”ì‹œì§€ ìˆ˜ì‹  í›„ Fork-ID ê²€ì¦

[x] í˜¸í™˜ë˜ì§€ ì•ŠìŒ ê°ì§€

[v] Error ë°˜í™˜ (panic ì•„ë‹˜)

5. Graceful ì—°ê²° ì¢…ë£Œ

[v] deferë¥¼ í†µí•œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬

[v] ë¡œê·¸ ê¸°ë¡

[v] ë‹¤ìŒ í”¼ì–´ ì‹œë„

  

â†’ ëª¨ë“  ë¹„í˜¸í™˜ í”¼ì–´ë§ˆë‹¤ 1-5 ë‹¨ê³„ë¥¼ ë°˜ë³µ!

```

  

**Error ì²˜ë¦¬ ìƒì„¸:**

  

Go-ethereumì˜ ì‹¤ì œ êµ¬í˜„ (eth/protocols/eth/handshake.go):

  

```go

// Status ë©”ì‹œì§€ ì½ê³  ê²€ì¦í•˜ëŠ” í•¨ìˆ˜

func readStatus(r io.Reader, s *Status) error {

// 1ë‹¨ê³„: RLP ë””ì½”ë”©ìœ¼ë¡œ Status ë©”ì‹œì§€ íŒŒì‹±

if err := rlp.Decode(r, &s); err != nil {

// ë©”ì‹œì§€ í˜•ì‹ì´ ì˜ëª»ë¨ â†’ ì¦‰ì‹œ ì‹¤íŒ¨

return err // â† Error ë°˜í™˜ (í”¼ì–´ ëŠê¸°)

}

  

// 2ë‹¨ê³„: Fork-ID ê²€ì¦ (EIP-2124)

// í”¼ì–´ì˜ fork_hashì™€ fork_nextê°€ ìš°ë¦¬ì˜ ì²´ì¸ê³¼ í˜¸í™˜ë˜ëŠ”ì§€ í™•ì¸

if err := forkFilter(s.ForkID); err != nil {

// í˜¸í™˜ë˜ì§€ ì•ŠëŠ” fork ê°ì§€

// â† Error ë°˜í™˜ (panic ì•„ë‹˜! â†’ graceful ì²˜ë¦¬)

return fmt.Errorf("incompatible fork: %w", err)

}

  

// 3ë‹¨ê³„: ëª¨ë“  ê²€ì¦ í†µê³¼

return nil // â† í˜¸í™˜ ê°€ëŠ¥í•œ í”¼ì–´

}

  

// í”¼ì–´ ì´ˆê¸°í™” í•¨ìˆ˜ (Status í•¸ë“œì…°ì´í¬ í¬í•¨)

func (p *Peer) Initialize() error {

// defer: í•¨ìˆ˜ ì¢…ë£Œ ì‹œ ìë™ìœ¼ë¡œ í”¼ì–´ ì—°ê²° ì¢…ë£Œ

// ì‹¤íŒ¨í•˜ë“  ì„±ê³µí•˜ë“  ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ë³´ì¥ (Graceful cleanup)

defer p.close()

  

// Status ë©”ì‹œì§€ ìƒì„±

status := &StatusPacket68{}

  

// Status ì½ê³  ê²€ì¦

if err := readStatus(p.connection, status); err != nil {

// í˜¸í™˜ë˜ì§€ ì•ŠëŠ” í”¼ì–´ ê°ì§€

// 1. ë¡œê·¸ ê¸°ë¡: ë‚˜ì¤‘ì— ë¬¸ì œ ì¶”ì  ê°€ëŠ¥

log.Debug("peer rejected", "peer", p.id, "reason", err)

  

// 2. Error ë°˜í™˜ (panic ì•„ë‹˜!)

// â†’ í”„ë¡œì„¸ìŠ¤ê°€ ì£½ì§€ ì•ŠìŒ

// â†’ ë‹¤ìŒ í”¼ì–´ë¡œ ê³„ì† ì‹œë„ ê°€ëŠ¥

return err

}

  

// í˜¸í™˜ ê°€ëŠ¥í•œ í”¼ì–´ â†’ ì •ìƒ ê³„ì† ì§„í–‰

return nil

}

```

  

**íŠ¹ì§•:**

```

- Error ë°˜í™˜: í˜¸í™˜ ë¶ˆê°€ëŠ¥ ì‹œ panic ì•„ë‹˜

- Graceful ì¢…ë£Œ: ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì™„ë£Œ í›„ ì¢…ë£Œ

- ë¡œê·¸ ê¸°ë¡: ë¬¸ì œ ì›ì¸ ì¶”ì  ê°€ëŠ¥

- ë‹¤ìŒ í”¼ì–´: í˜¸í™˜ ë¶ˆê°€ëŠ¥í•œ í”¼ì–´ëŠ” ë¬´ì‹œí•˜ê³  ê³„ì†

  

ì´ëŠ” Ethereum ë„¤íŠ¸ì›Œí¬ì˜ ì•ˆì •ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

ë„¤íŠ¸ì›Œí¬ ë¶„ì—´(fork)ì´ ë°œìƒí•´ë„ ë…¸ë“œê°€ ì£½ì§€ ì•ŠìŠµë‹ˆë‹¤.

```

  

#### ì‹¤ì œ í”¼í•´ ì‚¬ë¡€

  

EIP-2124ì—ì„œ ì–¸ê¸‰ëœ "Stale nodes" ë¬¸ì œ:

  

> "These stale nodes put a meaningless burden on the peer-to-peer network,

> since they just latch on to good nodes, but don't accept upgraded blocks."

  

**êµ¬ì²´ì  ì˜í–¥:**

```

1. ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ë‚­ë¹„

- ë¹„í˜¸í™˜ ë…¸ë“œì™€ì˜ ë¶ˆí•„ìš”í•œ ë°ì´í„° êµí™˜

- ë¸”ë¡ ì „íŒŒ ì†ë„ ì €í•˜

  

2. í”¼ì–´ ìŠ¬ë¡¯ ë‚­ë¹„

- ë…¸ë“œë‹¹ ì—°ê²°í•  ìˆ˜ ìˆëŠ” í”¼ì–´ ìˆ˜ ì œí•œ

- ë‚¡ì€ ë²„ì „ì˜ ë…¸ë“œê°€ ì¢‹ì€ í”¼ì–´ ì ìœ 

  

3. Ethereum â†” Ethereum Classic êµ¬ë¶„ ë¶ˆê°€

- ê°™ì€ ì œë„¤ì‹œìŠ¤ í•´ì‹œ ì‚¬ìš©

- chainIdë§Œìœ¼ë¡œëŠ” êµ¬ë¶„ ë¶ˆê°€ëŠ¥

- ë§¤ë²ˆ ìƒì„¸ ê²€ì¦ í•„ìš”

```

  

#### EIP-2124ì˜ ì†”ë£¨ì…˜

  

EIP-2124ì—ì„œ ì œì‹œí•œ í•´ê²°ì±…:

  

> "by aggressively cutting off incompatible nodes from each other

> we can extract a lot more value from the public nodes,

> making the entire P2P network much more robust and reliable"

  

**í•µì‹¬ ì•„ì´ë””ì–´: Discovery Layerì—ì„œ ë¯¸ë¦¬ í•„í„°ë§**

  

ENR (Ethereum Node Record)ì— Fork-IDë¥¼ í¬í•¨:

```

ENR êµ¬ì¡° (300 bytes ì œí•œ):

â”œâ”€ base info (IP, Port) : ~100 bytes

â”œâ”€ fork_id : 12 bytes â† NEW! (4 bytes hash + 8 bytes next)

â””â”€ ê¸°íƒ€ ì •ë³´

```

  

**Go-ethereumì˜ ì‹¤ì œ êµ¬í˜„:**

  

ENRì—ì„œ Fork-IDë¥¼ ì½ì–´ í”¼ì–´ ë°œê²¬ ì‹œ í˜¸í™˜ì„± í™•ì¸:

```go

// core/forkid/forkid.go - Filter êµ¬ì¡°

type Filter struct {

forks []uint64

hash [4]byte

}

  

// New Filter ìƒì„±

// NewFilter: ë¡œì»¬ ì²´ì¸ ì„¤ì •ìœ¼ë¡œë¶€í„° í˜¸í™˜ì„± ê²€ì¦ í•„í„° ìƒì„±

// ì´ í•„í„°ë¡œ ì›ê²© í”¼ì–´ì˜ Fork-ID ê²€ì¦ ì‹œ EIP-2124 ê·œì¹™ ì ìš©

func NewFilter(chain Blockchain) *Filter {

// ì…ë ¥: ë¡œì»¬ ì²´ì¸ì˜ ì„¤ì • (ì²´ì¸ID, í¬í¬ íˆìŠ¤í† ë¦¬)

// ì—­í• : ë¡œì»¬ì˜ fork_hashì™€ í¬í¬ ë°°ì—´ ìƒì„±

// ì‚¬ìš©ì²˜: ì›ê²© í”¼ì–´ì˜ Fork-IDë¥¼ ì´ê²ƒê³¼ ë¹„êµí•˜ì—¬ í˜¸í™˜ì„± íŒë‹¨

}

  

// IsValid: ì›ê²© í”¼ì–´ì˜ Fork-IDê°€ í˜¸í™˜ë˜ëŠ”ì§€ ê²€ì¦ (EIP-2124)

func (f *Filter) IsValid(forkid ID) bool {

// EIP-2124ì˜ 4ê°€ì§€ ê²€ì¦ ê·œì¹™ ìˆœì°¨ ì ìš©:

//

// ê·œì¹™ 1: fork_hash ì¼ì¹˜

// â†’ ë¡œì»¬ê³¼ ì›ê²©ì˜ fork_hashê°€ ê°™ìœ¼ë©´ í˜¸í™˜ì„± í™•ì¸ ë

// â†’ fork_nextë§Œ ë¹„êµí•˜ë©´ ë¨

//

// ê·œì¹™ 2: ì›ê²©ì´ ë¡œì»¬ì˜ ë¶€ë¶„ì§‘í•© (ê³¼ê±° ìƒíƒœ)

// â†’ ì›ê²©ì´ ë” ì˜¤ë˜ëœ í¬í¬ ìƒíƒœë¥¼ ê°€ì§

// â†’ ë¡œì»¬ì˜ ê³¼ê±° fork_hashì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

// â†’ ì¼ì¹˜í•˜ë©´ í˜¸í™˜ ê°€ëŠ¥ (ë¡œì»¬ì´ ë” ì§„í–‰ë¨)

//

// ê·œì¹™ 3: ì›ê²©ì´ ë¡œì»¬ì˜ ìƒìœ„ì§‘í•© (ë¯¸ë˜ ìƒíƒœ)

// â†’ ì›ê²©ì´ ë” ìµœì‹  í¬í¬ë¥¼ ê²½í—˜í•¨

// â†’ ë¡œì»¬ì´ ë”°ë¼ì¡ì„ ê°€ëŠ¥ì„± ìˆìœ¼ë¯€ë¡œ í˜¸í™˜

//

// ê·œì¹™ 4: ìœ„ 3ê°€ì§€ ëª¨ë‘ ê±°ì§“

// â†’ ë‹¤ë¥¸ ì²´ì¸ì´ê±°ë‚˜ ë²„ì „ ì°¨ì´

// â†’ ê²½ê³ : "Local or remote needs software update"

// â†’ í˜¸í™˜ ë¶ˆê°€ëŠ¥

}

```

  

**eth/protocols/eth/handshake.go - ì‹¤ì œ ê²€ì¦ (EIP-2124 ì ìš©):**

```go

// Status í•¸ë“œì…°ì´í¬ ë©”ì‹œì§€ ìˆ˜ì‹  ë° Fork-ID ê²€ì¦

func readStatus(r io.Reader, s *Status) error {

// 1ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ì—ì„œ Status ë©”ì‹œì§€ ìˆ˜ì‹  ë° RLP ë””ì½”ë”©

if err := rlp.Decode(r, &s); err != nil {

// ë©”ì‹œì§€ í˜•ì‹ì´ ì˜ëª»ë¨ (ì†ìƒë˜ì—ˆê±°ë‚˜ ì˜ëª»ëœ ë²„ì „)

return err // â† Error ë°˜í™˜ (í”¼ì–´ ì—°ê²° ëŠê¸°)

}

  

// 2ë‹¨ê³„: â† Fork-ID ê²€ì¦ ì¶”ê°€! (EIP-2124 í•µì‹¬)

// ì›ê²© í”¼ì–´ì˜ fork_idê°€ ë¡œì»¬ ì²´ì¸ê³¼ í˜¸í™˜ë˜ëŠ”ì§€ íŒë‹¨

// Filter.IsValid() í˜¸ì¶œ â†’ EIP-2124ì˜ 4ê°€ì§€ ê·œì¹™ ì ìš©

if err := forkFilter(s.ForkID); err != nil {

// í˜¸í™˜ë˜ì§€ ì•ŠëŠ” í¬í¬ ê°ì§€

// - ë‹¤ë¥¸ ì²´ì¸ì¼ ê°€ëŠ¥ì„±

// - ì›ê²©ì´ ë¡œì»¬ê³¼ ë‹¤ë¥¸ ì†Œí”„íŠ¸ì›¨ì–´ ë²„ì „

return fmt.Errorf("%w: %v", errForkIDRejected, err)

}

  

// 3ë‹¨ê³„: ëª¨ë“  ê²€ì¦ ì™„ë£Œ â†’ í˜¸í™˜ ê°€ëŠ¥í•œ í”¼ì–´

return nil

}

```

  

**ê°œì„ ëœ í”„ë¡œì„¸ìŠ¤:**

```

EIP-2124 ì´í›„:

1. Peer ë°œê²¬ (DHT ë˜ëŠ” Bootnodes)

2. ENRì—ì„œ Fork-ID ì½ê¸° (ë§¤ìš° ë¹ ë¦„!)

3. Fork-ID ê²€ì¦

â”œâ”€ í˜¸í™˜? â†’ TCP ì—°ê²° ì‹œë„

â””â”€ ë¹„í˜¸í™˜? â†’ ìŠ¤í‚µ (ì—°ê²° ì•ˆ í•¨!)

4. í˜¸í™˜í•˜ëŠ” í”¼ì–´ë§Œ TCP ì—°ê²°

  

â†’ ë¹„í˜¸í™˜ í”¼ì–´ëŠ” ì²˜ìŒë¶€í„° í•„í„°ë§!

â†’ TCP/RLPx/Handshake ë¹„ìš© ì ˆê°!

```

  

### EIP-2124ì˜ ìŠ¤í™

  

#### Fork-ID êµ¬ì¡°

  

EIP-2124 ìŠ¤í™ì—ì„œ ì •ì˜í•œ êµ¬ì¡°:

  

```

Fork-ID = RLP([FORK_HASH, FORK_NEXT])

  

where:

FORK_HASH: 4ë°”ì´íŠ¸ CRC32 ì²´í¬ì„¬

= CRC32(genesis_hash + sorted(activated_fork_blocks))

  

FORK_NEXT: ë‹¤ìŒ í¬í¬ì˜ ë¸”ë¡ ë²ˆí˜¸ ë˜ëŠ” íƒ€ì„ìŠ¤íƒ¬í”„

= ë…¸ë“œê°€ ì•„ì§ ê²½í—˜í•˜ì§€ ì•Šì€ ì²« ë²ˆì§¸ í¬í¬

```

  

#### ìŠ¤í™ì˜ ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

  

**FORK_HASH ê³„ì‚°:**

```

1. Genesis hashë¡œ ì‹œì‘

2. í™œì„±í™”ëœ ëª¨ë“  í¬í¬ë¥¼ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬

3. CRC32 ì²´í¬ì„¬ ê³„ì‚°

4. ì¤‘ë³µ ì œê±° (ê°™ì€ ë¸”ë¡ì—ì„œ ì—¬ëŸ¬ í¬í¬)

```

  

**FORK_NEXTì˜ ì—­í• :**

```

"FORK_NEXTëŠ” ì›ê²© ë…¸ë“œê°€ í•©ë²•ì ìœ¼ë¡œ ë™ê¸°í™” ì¤‘ì¸ì§€

ì•„ë‹ˆë©´ êµ¬ë²„ì „ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‹¤í–‰ ì¤‘ì¸ì§€ êµ¬ë¶„í•˜ëŠ” ì—­í• "

```

  

ì´ ì •ë³´ ì—†ì´ëŠ” ë‘ ìƒíƒœë¥¼ êµ¬ë¶„í•  ìˆ˜ ì—†ìŒ.

  

**Fork-IDì˜ 3ê°€ì§€ ì„¤ê³„ ì›ì¹™:**

  

```

1. ê²°ì •ë¡ ì (Deterministic)

ê°™ì€ ì…ë ¥(ì œë„¤ì‹œìŠ¤, í¬í¬ ì„¤ì •) â†’ í•­ìƒ ê°™ì€ ì¶œë ¥(Fork-ID)

ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì¼í•œ ê²°ê³¼ ê³„ì‚°

  

2. íš¨ìœ¨ì (Efficient)

4ë°”ì´íŠ¸ì˜ ì‘ì€ í¬ê¸°

O(n) ê³„ì‚° (n = í¬í¬ ê°œìˆ˜)

ë¹„íŠ¸ ì—°ì‚° ê¸°ë°˜ (CRC32)

  

3. í™•ì¥ ê°€ëŠ¥(Extensible)

ìƒˆë¡œìš´ í¬í¬ ì¶”ê°€ ì‹œ ìë™ ë°˜ì˜

í¬í¬ íˆìŠ¤í† ë¦¬ ì „ì²´ë¥¼ ì••ì¶•í•˜ì—¬ ì €ì¥

```

  

### Fork-IDì˜ í•µì‹¬ í†µì°°

  

```rust

// Fork-IDëŠ” "í˜„ì¬ ì²´ì¸ ìƒíƒœì˜ ìš”ì•½"

Fork-ID = {

fork_hash: CRC32(genesis_hash + all_activated_forks),

fork_next: next_fork_block_or_timestamp

}

  

// ì´ê²ƒì€ "ì´ ë…¸ë“œê°€ ì–´ëŠ í¬í¬ê¹Œì§€ ê²½í—˜í–ˆëŠ”ê°€"ë¥¼ ì••ì¶•í•œ ì •ë³´

```

  

ì˜ˆì‹œ:

```

ë…¸ë“œê°€ Shanghai í¬í¬ë¥¼ ë°©ê¸ˆ ê²½í—˜í–ˆë‹¤ë©´:

fork_hash = CRC32(genesis + homestead + dao + ... + shanghai)

fork_next = 1710338135 (Cancun ì‹œì )

  

ì´ ì •ë³´ë§Œìœ¼ë¡œ:

[v] ì´ ë…¸ë“œëŠ” ì ì–´ë„ Shanghaiê¹Œì§€ í™œì„±í™”ë¨

[v] ë‹¤ìŒ í¬í¬ëŠ” Cancun

[v] Cancunì€ ì•„ì§ ì•ˆ í–ˆìŒ

```

  

---

  

## CRC32 ì„ íƒì˜ ê¸°ìˆ ì  ë°°ê²½

  

### ì™œ CRC32ì¸ê°€?

  

#### 1. ì›ë¦¬: CRC (Cyclic Redundancy Check)

  

**ì—­ì‚¬ì  ë°°ê²½:**

	- 1960ë…„ëŒ€: í†µì‹  ì˜¤ë¥˜ ê°ì§€ìš©ìœ¼ë¡œ ê°œë°œ

- í•˜ë“œì›¨ì–´ ì¹œí™”ì  (ë¹„íŠ¸ ì‹œí”„íŠ¸ ì—°ì‚°)

- ê³ ì† ê³„ì‚° ê°€ëŠ¥

  

**ìˆ˜í•™ì  ì •ì˜:**

  

CRC32ëŠ” ë‹¤í•­ì‹ ë‚˜ëˆ—ì…ˆì„ ì´ìš©í•œ ë‚˜ë¨¸ì§€ ì—°ì‚°ì…ë‹ˆë‹¤:

  

```

ì…ë ¥ ë°ì´í„°: D (ë¹„íŠ¸ ìŠ¤íŠ¸ë¦¼)

CRC ë‹¤í•­ì‹: P = x^32 + x^26 + x^23 + ... + x + 1

ë‹¤í•­ì‹ì˜ í—¥ìŠ¤ í‘œí˜„: 0x04C11DB7 (ë˜ëŠ” reversed: 0xEDB88320)

  

CRC32(D) = D Ã— 2^32 mod P

  

êµ¬ì²´ì ìœ¼ë¡œ:

1. ì…ë ¥ ë°ì´í„°ë¥¼ 32ë¹„íŠ¸ ìˆ«ìì²˜ëŸ¼ í•´ì„

2. ë‹¤í•­ì‹ Pë¡œ ë‚˜ëˆ” (XOR ì—°ì‚° ì‚¬ìš©)

3. ë‚˜ë¨¸ì§€ë¥¼ ê²°ê³¼ë¡œ ë°˜í™˜

```

  

#### ë‹¤í•­ì‹ì„ í—¥ìŠ¤ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•

  

ë‹¤í•­ì‹ P = x^32 + x^26 + x^23 + x^22 + x^16 + x^12 + x^11 + x^10 + x^8 + x^7 + x^5 + x^4 + x^2 + x + 1

  

**ë‹¨ê³„ 1: ê° í•­ì„ ë¹„íŠ¸ ìœ„ì¹˜ë¡œ í‘œí˜„**

```

x^32 â†’ ë¹„íŠ¸ 32 (ìµœìƒìœ„)

x^26 â†’ ë¹„íŠ¸ 26

x^23 â†’ ë¹„íŠ¸ 23

... (ì´í•˜ ìƒëµ)

x^1 â†’ ë¹„íŠ¸ 1

1 â†’ ë¹„íŠ¸ 0 (ìµœí•˜ìœ„)

```

  

**ë‹¨ê³„ 2: 32ë¹„íŠ¸ ì´ì§„ìˆ˜ë¡œ í‘œí˜„**

```

ë¹„íŠ¸: 33222222222211111111110000000000

10987654321098765432109876543210

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ê°’: 00000100110000011101101110110111

(ê° ìë¦¬ê°€ 1ì´ë©´ í•´ë‹¹ ì§€ìˆ˜ì˜ í•­ì´ ì¡´ì¬)

```

  

**ë‹¨ê³„ 3: 4ë¹„íŠ¸ì”© ê·¸ë£¹í™” â†’ 16ì§„ìˆ˜ë¡œ ë³€í™˜**

```

0000 â”‚ 0100 â”‚ 1100 â”‚ 0001 â”‚ 1101 â”‚ 1011 â”‚ 1011 â”‚ 0111

0 â”‚ 4 â”‚ C â”‚ 1 â”‚ D â”‚ B â”‚ B â”‚ 7

  

ê²°ê³¼: 0x04C11DB7

```

  

**Reversed ë²„ì „ (0xEDB88320)**

- ë¹„íŠ¸ë¥¼ ì—­ìˆœìœ¼ë¡œ ë’¤ì§‘ì€ í˜•íƒœ

- ì‹¤ì œ CRC ê³„ì‚°ì—ì„œëŠ” íš¨ìœ¨ì„± ë•Œë¬¸ì— ì´ ë²„ì „ì„ ì£¼ë¡œ ì‚¬ìš©

  

**ì˜ˆì‹œ ê³„ì‚°:**

  

```

Mainnet Genesis Hash (ì²˜ìŒ 8ë°”ì´íŠ¸):

0x 00 00 00 00 00 00 00 00

  

CRC32 ê³„ì‚°:

Input: 00000000 00000000 00000000 00000000

00000000 00000000 00000000 00000000

â†“ (ë¹„íŠ¸ ì‹œí”„íŠ¸ì™€ XOR ë°˜ë³µ)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—

â•‘ CRC32 ë‹¤í•­ì‹ ë‚˜ëˆ—ì…ˆ â•‘

â•‘ (ì‚¬ì‹¤ì€ reflection ì‚¬ìš©) â•‘

â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Output: 0xFE3366E7

  

ì´ ê°’ì´ Mainnetì˜ Genesis Fork-ID hash!

```

  

**ì‘ë™ ì›ë¦¬:**

```

ì…ë ¥: genesis_hash (256ë¹„íŠ¸) + í¬í¬ ë¸”ë¡ë“¤

â†“

ê° ë°”ì´íŠ¸ë§ˆë‹¤ CRC32 ì—…ë°ì´íŠ¸

â†“

ëˆ„ì ì  í•´ì‹œ (ì´ì „ ê²°ê³¼ë¥¼ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©)

â†“

ì¶œë ¥: 32ë¹„íŠ¸ ë‚˜ë¨¸ì§€ (CRC32)

  

íŠ¹ì§•:

- ì…ë ¥ì´ ì¡°ê¸ˆë§Œ ë³€í•´ë„ ì¶œë ¥ ì™„ì „íˆ ë³€í•¨

- ìˆœì„œ ì˜ì¡´ì  (í¬í¬ ìˆœì„œ ë°”ë€Œë©´ ê²°ê³¼ ë‹¤ë¦„)

- ëˆ„ì ì  (ì´ì „ ê²°ê³¼ ìœ„ì— ìŒ“ì„)

```

  

**Go-ethereumì˜ ì‹¤ì œ êµ¬í˜„ (IEEE í‘œì¤€ CRC32):**

  

```go

// CRC32 ì´ˆê¸°í™” (IEEE polynomial 0xEDB88320)

h := crc32.NewIEEE()

  

// Genesis hashë¡œ ì—…ë°ì´íŠ¸

h.Write(genesisHash.Bytes()) // 32 bytes

  

// ê° í¬í¬ì˜ ë¸”ë¡ ë²ˆí˜¸ ì¶”ê°€

h.Write([]byte{0x00, 0x11, 0x8E, 0x00}) // 1,150,000 (Homestead)

h.Write([]byte{0x00, 0x1D, 0x4C, 0x00}) // 1,920,000 (DAO)

// ... ê³„ì† ...

  

// ìµœì¢… ê²°ê³¼

result := h.Sum32() // ì˜ˆ: 0x97C2C34C

```

  

#### 2. CRC32 vs ë‹¤ë¥¸ ì„ íƒì§€

  

EIP-2124 Rationaleì—ì„œ ì§ì ‘ ì¸ìš©:

  

> "Why CRC32 over Keccak256? CRC32 was designed for exactly

> this purposeâ€”flattening arbitrary data into fixed checksums.

> Cryptographic properties are unnecessary since nodes can lie anyway."

  

**í•µì‹¬ í†µì°°:**

```

Fork-IDëŠ” ì•”í˜¸í•™ì  ë³´ì•ˆì´ í•„ìš”í•˜ì§€ ì•ŠìŒ

â†’ ë…¸ë“œëŠ” ì–´ì°¨í”¼ ê±°ì§“ë§í•  ìˆ˜ ìˆìŒ (í˜‘ë ¥ ì—†ì´ëŠ” ê²€ì¦ ë¶ˆê°€)

â†’ ë”°ë¼ì„œ ì„±ëŠ¥ê³¼ íš¨ìœ¨ì„±ì´ ë” ì¤‘ìš”

```

  

**ê³µì‹ ë¹„êµ:**

  

| í•´ì‹œ í•¨ìˆ˜ | í¬ê¸° | ì„¤ê³„ ëª©ì  | ì†ë„ | EIP-2124 í‰ê°€ |

|----------|------|---------|------|--------------|

| **CRC32** | **4ë°”ì´íŠ¸** | ì˜¤ë¥˜ ê°ì§€ | **ë§¤ìš° ë¹ ë¦„** | âœ… ì´ìƒì  |

| Keccak256 | 32ë°”ì´íŠ¸ | ì•”í˜¸í•™ì  ë³´ì•ˆ | ëŠë¦¼ | âŒ ì˜¤ë²„ìŠ¤í™ |

| MD5 | 16ë°”ì´íŠ¸ | ì•”í˜¸í•™ | ì¤‘ê°„ | âŒ ë³´ì•ˆ ì•½í•¨ |

| SHA-1 | 20ë°”ì´íŠ¸ | ì•”í˜¸í•™ | ì¤‘ê°„ | âŒ ë³´ì•ˆ ì•½í•¨ |

  

**Discovery ENR í¬ê¸° ì œì•½:**

  

EIP-2124 Rationale:

> "Discovery ENRs have only 300 bytes total.

> CRC32 checksums suffice for collision prevention across

> Ethereum networks."

  

```

ENR êµ¬ì¡°:

â”œâ”€ Base info (IP, Port, ID) : ~150 bytes

â”œâ”€ Fork-ID ì •ë³´ : 12 bytes (4 + 8)

â””â”€ ê¸°íƒ€ ì •ë³´ : ~140 bytes

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì´ 300 bytes ì œí•œ

  

CRC32 ì‚¬ìš©ìœ¼ë¡œ ê° ë…¸ë“œê°€ 1.2KB ëŒ€ì‹  12 bytesë§Œ ì‚¬ìš© ê°€ëŠ¥!

```

  

#### 3. Go-ethereumì˜ ì‹¤ì œ CRC32 êµ¬í˜„

  

**Go-ethereum core/forkid/forkid.goì—ì„œ:**

  

```go

// ID: Fork-ID ê³„ì‚° (Go-ethereum êµ¬í˜„)

// í˜„ì¬ ë¸”ë¡/íƒ€ì„ìŠ¤íƒí”„ì—ì„œ fork_hashë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜

func ID(chain Blockchain, genesis, head uint64) [4]byte {

// 1ë‹¨ê³„: RLP ì¸ì½”ë”© (ì‹¤ì œë¡œëŠ” ì‚¬ìš© ì•ˆ í•¨, ë‹¨ìˆœ í˜•ì‹ ì •ì˜)

var hash uint32

rlp.Encode([]interface{}{hash, []uint64{}})

  

// 2ë‹¨ê³„: í™œì„±í™”ëœ ëª¨ë“  í¬í¬ ìˆ˜ì§‘ ë° ì •ë ¬

forks := gatherForks(chain) // â† Genesisë¶€í„° í˜„ì¬ê¹Œì§€ ëª¨ë“  í¬í¬

  

// 3ë‹¨ê³„: CRC32 í•´ì…” ì´ˆê¸°í™” (IEEE ë‹¤í•­ì‹ ì‚¬ìš©)

h := crc32.NewIEEE()

// Genesis í•´ì‹œë¡œ CRC32 ì‹œì‘

h.Write([]byte{...}) // genesis hash bytes (32 bytes)

  

// 4ë‹¨ê³„: í˜„ì¬ headê¹Œì§€ í™œì„±í™”ëœ í¬í¬ë“¤ì„ CRC32ì— ëˆ„ì 

for _, fork := range forks {

if fork > head {

// ë‹¤ìŒ í¬í¬ì— ë„ë‹¬ (ì•„ì§ í™œì„±í™” ì•ˆ ë¨)

// â†’ fork_next ê°’ìœ¼ë¡œ ì‚¬ìš©ë¨ (ë³„ë„ ë¡œì§)

return h.Sum32() // â† í˜„ì¬ê¹Œì§€ì˜ fork_hashë§Œ ë°˜í™˜

}

// ì´ í¬í¬ëŠ” ì´ë¯¸ í™œì„±í™”ë¨ â†’ CRC32ì— ì¶”ê°€

h.Write(fork.Bytes()) // í¬í¬ ë¸”ë¡ ë²ˆí˜¸/íƒ€ì„ìŠ¤íƒí”„ ì¶”ê°€

}

  

// 5ë‹¨ê³„: ëª¨ë“  í¬í¬ë¥¼ í†µê³¼í–ˆì„ ë•Œ (ìµœì‹  ìƒíƒœ)

return h.Sum32()

}

  

// gatherForks: ì²´ì¸ ì„¤ì •ì—ì„œ ëª¨ë“  í¬í¬ ì •ë³´ ì¶”ì¶œ (Reflection ì‚¬ìš©)

// Goì˜ reflectionì„ í†µí•´ ë™ì ìœ¼ë¡œ í¬í¬ í•„ë“œ ì°¾ê¸°

func gatherForks(config *ChainConfig) []uint64 {

// 1ë‹¨ê³„: í¬í¬ ì •ë³´ ì €ì¥ ë°°ì—´ ì´ˆê¸°í™”

var forks []uint64

  

// êµ¬ì¡°ì²´ì˜ ëª¨ë“  í•„ë“œë¥¼ ìˆœíšŒ

v := reflect.ValueOf(config).Elem()

for i := 0; i < v.NumField(); i++ {

f := v.Field(i)

  

// í¬í¬ í•„ë“œ ì°¾ê¸° (Blockìœ¼ë¡œ ëë‚˜ëŠ” í•„ë“œ)

if strings.HasSuffix(v.Type().Field(i).Name, "Block") {

if val := f.Uint(); val > 0 {

forks = append(forks, val)

}

}

}

  

sort.Slice(forks, func(i, j int) bool {

return forks[i] < forks[j]

})

  

return forks

}

```

  

**ì¤‘ìš”í•œ íŠ¹ì§•:**

```

1. ëˆ„ì ì (Cumulative)

CRC32(A) â‰  CRC32(A + B)

ê° í¬í¬ ì¶”ê°€ ì‹œ ì´ì „ í•´ì‹œì— ì—…ë°ì´íŠ¸

  

2. ìˆœì„œ ì˜ì¡´ì 

í¬í¬ ìˆœì„œê°€ ë³€í•˜ë©´ ê²°ê³¼ ë³€í•¨

â†’ Homestead â†’ DAO â†’ EIP150 (O)

â†’ DAO â†’ Homestead â†’ EIP150 (X)

  

3. ë¸”ë¡ ë²ˆí˜¸ ê¸°ë°˜

Mainnet:

- Genesis: hash_0

- + 1150000 (Homestead): hash_1

- + 1920000 (DAO): hash_2

- + ... (ê³„ì†)

```

  

#### 4. ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ì„±

  

**ì „ì†¡ ë¹„ìš© ë¹„êµ:**

  

```

ë°©ë²• 1: ì „ì²´ í¬í¬ ì´ë ¥ ì „ì†¡ (EIP-2124 ì´ì „)

â”œâ”€ Homestead: 8ë°”ì´íŠ¸

â”œâ”€ DAO: 8ë°”ì´íŠ¸

â”œâ”€ EIP150: 8ë°”ì´íŠ¸

â”œâ”€ EIP155: 8ë°”ì´íŠ¸

â”œâ”€ ... (12ê°œ í¬í¬)

â””â”€ ì´í•©: ~96ë°”ì´íŠ¸

  

ë°©ë²• 2: Fork-ID ì „ì†¡ (EIP-2124)

â”œâ”€ fork_hash: 4ë°”ì´íŠ¸

â””â”€ fork_next: 8ë°”ì´íŠ¸

â””â”€ ì´í•©: 12ë°”ì´íŠ¸

  

íš¨ìœ¨ì„±: 96 / 12 = 8ë°° ë” ì‘ìŒ! ğŸ¯

  

Discovery ENR ì ˆê°:

â”œâ”€ ì´ì „: ~1.2KB (ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  í¬í¬ ì •ë³´)

â”œâ”€ ì´í›„: 12ë°”ì´íŠ¸ (Fork-IDë§Œ)

â””â”€ ì ˆê°: 99% ì´ìƒ!

```

  

---

  

## PoW ì‹œëŒ€: ë¸”ë¡ ê¸°ë°˜ ë™ê¸°í™”

  

### Ethereum ì´ˆì°½ê¸° (2015-2022)

  

#### ë¬¸ì œ ìƒí™©

  

```

2015ë…„ 7ì›” 30ì¼, Ethereum ì œë„¤ì‹œìŠ¤ ë¸”ë¡ ìƒì„±

â”œâ”€ ì±„êµ´ ì‹œì‘

â”œâ”€ ë¸”ë¡ ìƒì„± ì‹œê°„: ë¶ˆê·œì¹™ (10ì´ˆ ~ 20ì´ˆ)

â””â”€ í‰ê· : ~13ì´ˆ (ëª©í‘œ)

```

  

**ì™œ ë¶ˆê·œì¹™ì¸ê°€?**

```

PoW (Proof of Work) = ì±„êµ´ ë‚œì œ í’€ì´

â”œâ”€ ë‚œì œ ë‚œì´ë„ âˆ ë„¤íŠ¸ì›Œí¬ í•´ì‹œìœ¨

â””â”€ í•´ì‹œìœ¨ì´ ë³€í•˜ë©´ â†’ ë‚œì´ë„ ì¡°ì • í•„ìš”

â†’ ë¸”ë¡ ìƒì„± ì‹œê°„ ë³€í•¨

  

ì˜ˆì‹œ:

- ê²½ìš° 1: ì±„êµ´ì ë§ìŒ â†’ í•´ì‹œìœ¨ ë†’ìŒ â†’ ë¸”ë¡ ë¹¨ë¦¬ ìƒì„± (8ì´ˆ)

- ê²½ìš° 2: ì±„êµ´ì ì ìŒ â†’ í•´ì‹œìœ¨ ë‚®ìŒ â†’ ë¸”ë¡ ëŠë¦¬ê²Œ ìƒì„± (18ì´ˆ)

```

  

#### ì†”ë£¨ì…˜: ë¸”ë¡ ë²ˆí˜¸ ê¸°ë°˜ í¬í¬

  

```

"í¬í¬ëŠ” íŠ¹ì • ë¸”ë¡ ë²ˆí˜¸ì—ì„œ í™œì„±í™”ëœë‹¤"

  

ì˜ˆ: Homestead í¬í¬

"ë¸”ë¡ 1,150,000ë¶€í„° Homestead ê·œì¹™ ì ìš©"

  

ì™œ?

- ëª¨ë“  ë…¸ë“œê°€ ê°™ì€ ë¸”ë¡ ì²´ì¸ì„ ì¶”ì 

- ë¸”ë¡ ë²ˆí˜¸ëŠ” ì ˆëŒ€ì ì´ê³  ë³€í•˜ì§€ ì•ŠìŒ

- ì‹œê°„ì€ ìƒëŒ€ì ì´ì§€ë§Œ ë¸”ë¡ ë²ˆí˜¸ëŠ” ì ˆëŒ€ì 

```

  

#### Fork-ID ê³„ì‚° (PoW ì‹œëŒ€)

  

```rust

pub fn calculate_fork_id_pow(

chain_config: ChainConfig,

current_block_number: u64,

) -> ForkId {

let mut hasher = CRC32::new();

hasher.update(genesis_hash);

  

// í˜„ì¬ ë¸”ë¡ ë²ˆí˜¸ê¹Œì§€ í™œì„±í™”ëœ í¬í¬ë¥¼ ëª¨ë‘ í¬í•¨

for fork in chain_config.get_forks() {

if fork.block_number <= current_block_number {

hasher.update(fork.block_number.to_bytes());

} else {

// ë‹¤ìŒ í¬í¬ë¥¼ ì°¾ìŒ

return ForkId {

fork_hash: hasher.finalize(),

fork_next: fork.block_number,

};

}

}

}

```

  

**Mainnetì˜ PoW í¬í¬ë“¤:**

```

ë¸”ë¡ 0: Genesis

ë¸”ë¡ 1,150,000: Homestead â† fork-id ë³€í•¨

ë¸”ë¡ 1,920,000: DAO Fork â† fork-id ë³€í•¨

ë¸”ë¡ 2,463,000: EIP150 (Tangerine Whistle) â† fork-id ë³€í•¨

ë¸”ë¡ 2,675,000: EIP155/158 (Spurious Dragon) â† fork-id ë³€í•¨

ë¸”ë¡ 4,370,000: Byzantium â† fork-id ë³€í•¨

ë¸”ë¡ 7,280,000: Constantinople â† fork-id ë³€í•¨

ë¸”ë¡ 7,280,000: Petersburg â† fork-id ë³€í•¨ (ê°™ì€ ë¸”ë¡)

ë¸”ë¡ 9,069,000: Istanbul â† fork-id ë³€í•¨

ë¸”ë¡ 9,200,000: Muir Glacier â† fork-id ë³€í•¨

ë¸”ë¡ 12,244,000: Berlin â† fork-id ë³€í•¨

ë¸”ë¡ 12,965,000: London â† fork-id ë³€í•¨

ë¸”ë¡ 13,773,000: Arrow Glacier â† fork-id ë³€í•¨

ë¸”ë¡ 15,050,000: Gray Glacier â† fork-id ë³€í•¨

ë¸”ë¡ 17,034,870: Merge (PoSë¡œ ì „í™˜!) â† fork-id ë³€í•¨, ì´ì œ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜

```

  

---

  

## PoS ì „í™˜: The Mergeì™€ ê¸°ìˆ ì  ë³€í™”

  

### The Merge (2022ë…„ 9ì›” 15ì¼)

  

#### ì—­ì‚¬ì  ì´ë²¤íŠ¸

  

```

2022ë…„ 9ì›” 15ì¼, ë¸”ë¡ 17,034,870

â””â”€ Ethereum PoW â†’ PoS ì „í™˜ (The Merge)

```

  

**ì´ì „:**

```

ë‹¨ê³„ 1: ì±„êµ´ìë“¤ì´ ë¸”ë¡ ì±„êµ´ (PoW)

ë‹¨ê³„ 2: Beacon Chain (PoS)ì´ ë³‘í–‰ ì‹¤í–‰ ì¤‘

â†’ ë‘ ì²´ì¸ì´ ë™ì‹œì— ì‹¤í–‰

```

  

**The Merge í›„:**

```

ë‹¨ê³„ 1: Beacon Chain (PoS)ì´ ë©”ì¸ ì²´ì¸ì´ ë¨

ë‹¨ê³„ 2: ì´ë”ë¦¬ì›€ì€ ì™„ì „í•œ PoS ë„¤íŠ¸ì›Œí¬ë¡œ

```

  

#### ê¸°ìˆ ì  ë³€í™”

  

```

PoW ì‹œëŒ€:

â”œâ”€ ë¸”ë¡ ìƒì„±: ì±„êµ´ìê°€ ì±„êµ´ ë‚œì œ í’€ì´

â”œâ”€ ë¸”ë¡ ì‹œê°„: ë¶ˆê·œì¹™ (í‰ê·  13ì´ˆ)

â”œâ”€ í•©ì˜: Longest Chain Rule (ê°€ì¥ ê¸´ ì²´ì¸)

â””â”€ Fork-ID: ë¸”ë¡ ë²ˆí˜¸ ê¸°ë°˜

  

PoS ì‹œëŒ€:

â”œâ”€ ë¸”ë¡ ìƒì„±: ê²€ì¦ìê°€ ìˆœë²ˆëŒ€ë¡œ ìƒì„±

â”œâ”€ ë¸”ë¡ ì‹œê°„: ì •í™•íˆ 12ì´ˆ (Slot: 12ì´ˆ, Epoch: 32 slot)

â”œâ”€ í•©ì˜: Finality (í™•ì •ì„±)

â””â”€ Fork-ID: íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜

```

  

#### ì™œ íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ ë³€ê²½í–ˆëŠ”ê°€?

  

```

PoS ì‹œëŒ€ì˜ íŠ¹ì„±:

1. ì •í™•í•œ ì‹œê°„ ë™ê¸°í™”

- Beacon Chainì€ ì‹œê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„ë¨

- ê° ìŠ¬ë¡¯ = 12ì´ˆ ê°„ê²©

- ëª¨ë“  ê²€ì¦ìê°€ ê°™ì€ ìŠ¬ë¡¯ ë²ˆí˜¸ ì¶”ì 

  

2. ë¸”ë¡ ë²ˆí˜¸ì˜ ë¬´ì˜ë¯¸ì„±

PoW: ë¸”ë¡ ìƒì„± ì‹œê°„ = ë¶ˆê·œì¹™ â†’ ë¸”ë¡ ë²ˆí˜¸ë¡œ ì‹œê°„ ì˜ˆì¸¡ ë¶ˆê°€

PoS: ë¸”ë¡ ìƒì„± ì‹œê°„ = ì •í™•í•¨ â†’ ë¸”ë¡ ë²ˆí˜¸ë¡œ ì‹œê°„ ì˜ˆì¸¡ ê°€ëŠ¥!

í•˜ì§€ë§Œ ì—¬ì „íˆ íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ë” ì •í™•

  

3. í¬í¬ í™œì„±í™”ì˜ ìƒˆë¡œìš´ ê¸°ì¤€

"íƒ€ì„ìŠ¤íƒ¬í”„ Xì—ì„œ í¬í¬ í™œì„±í™”"

â†’ ëª¨ë“  ë…¸ë“œê°€ ê°™ì€ UTC ì‹œê°„ ê¸°ë°˜ìœ¼ë¡œ íŒë‹¨

```

  

---

  

## ê³ ì • ë¸”ë¡ íƒ€ì„ì˜ ì˜ë¯¸

  

### PoSì˜ ìŠ¬ë¡¯ ë©”ì»¤ë‹ˆì¦˜

  

#### êµ¬ì¡°

  

```

Epoch 0 (32ê°œ ìŠ¬ë¡¯, 384ì´ˆ)

â”œâ”€ Slot 0 (12ì´ˆ): ê²€ì¦ì 0ì´ ë¸”ë¡ ìƒì„±

â”œâ”€ Slot 1 (12ì´ˆ): ê²€ì¦ì 1ì´ ë¸”ë¡ ìƒì„±

â”œâ”€ Slot 2 (12ì´ˆ): ê²€ì¦ì 2ê°€ ë¸”ë¡ ìƒì„±

â””â”€ ... (32ê°œ ìŠ¬ë¡¯)

  

Epoch 1 (32ê°œ ìŠ¬ë¡¯, 384ì´ˆ)

â””â”€ ...

```

  

**íŠ¹ì§•:**

```

Slot ë²ˆí˜¸ = ê³ ìœ í•˜ê³  ì¦ê°€í•˜ëŠ” ì‹œê°„ ì¸ë±ìŠ¤

Slot Duration = í•­ìƒ 12ì´ˆ

  

ë”°ë¼ì„œ:

- ì‹¤ì œ ì‹œê°„ = Slot 0 ì‹œì‘ ì‹œê°„ + (Slot ë²ˆí˜¸ Ã— 12ì´ˆ)

- ëª¨ë“  ë…¸ë“œê°€ ê°™ì€ ìŠ¬ë¡¯ ë²ˆí˜¸ë¥¼ ì¶”ì 

- ë„¤íŠ¸ì›Œí¬ ì „ì²´ê°€ ì‹œê°„ ë™ê¸°í™”

```

  

#### ë¸”ë¡ ìŠ¤í‚µ

  

```

ì •ìƒ ê²½ìš°:

â””â”€ Slot 0 â†’ Slot 1 â†’ Slot 2 â†’ ...

(ëª¨ë“  ìŠ¬ë¡¯ì—ì„œ ë¸”ë¡ ìƒì„±)

  

ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œ:

â””â”€ Slot 0 (ë¸”ë¡ ìƒì„±) â†’ Slot 1 (ë¸”ë¡ ì—†ìŒ) â†’ Slot 2 (ë¸”ë¡ ìƒì„±)

(ì¼ë¶€ ìŠ¬ë¡¯ì€ ë¸”ë¡ ì—†ì„ ìˆ˜ ìˆìŒ)

  

ì¤‘ìš”:

- ë¸”ë¡ ë²ˆí˜¸ â‰  ìŠ¬ë¡¯ ë²ˆí˜¸

- ìŠ¬ë¡¯ ë²ˆí˜¸ëŠ” ì—°ì†ì´ì§€ë§Œ ë¸”ë¡ ë²ˆí˜¸ëŠ” ê±´ë„ˆëœ€

- ë”°ë¼ì„œ íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ë” ì •í™•í•œ ê¸°ì¤€!

```

  

### Mainnetì˜ PoS í¬í¬ë“¤

  

```

ë¸”ë¡ 17,034,870: Merge (PoS ì‹œì‘)

â†“ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ìœ¼ë¡œ ì „í™˜

íƒ€ì„ìŠ¤íƒ¬í”„ 1681338455 (2023-04-12): Shanghai â† fork-id ë³€í•¨

íƒ€ì„ìŠ¤íƒ¬í”„ 1710338135 (2024-03-13): Cancun â† fork-id ë³€í•¨

íƒ€ì„ìŠ¤íƒ¬í”„ 1746612311 (2025-01-07): Prague â† fork-id ë³€í•¨

íƒ€ì„ìŠ¤íƒ¬í”„ 1764798551 (2025-10-05): Osaka â† fork-id ë³€í•¨

íƒ€ì„ìŠ¤íƒ¬í”„ 1765290071 (2025-10-09): BPO1 â† fork-id ë³€í•¨

íƒ€ì„ìŠ¤íƒ¬í”„ 1767747671 (2025-11-07): BPO2 â† fork-id ë³€í•¨

```

  

**íŠ¹ì§•:**

```

ë¸”ë¡ ë†’ì´ë¥¼ ëª¨ë¥´ê³ ë„ íƒ€ì„ìŠ¤íƒ¬í”„ë§Œìœ¼ë¡œ í¬í¬ íŒë‹¨ ê°€ëŠ¥

ì˜ˆ: "ì§€ê¸ˆì´ 2025-03-13ì´ë©´ Cancunì´ í™œì„±í™”ë˜ì—ˆë‹¤"

```

  

---

  

## í…ŒìŠ¤íŠ¸ë„· ì„¤ê³„ ì² í•™

  

### Holesky: "PoS ì „ìš© í…ŒìŠ¤íŠ¸ë„·"

  

#### ì„¤ê³„ ì˜ë„

  

```

"ì‹¤ì „ PoS í™˜ê²½ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ë‹¤"

```

  

#### íŠ¹ì§•

  

```json

{

"config": {

"mergeNetsplitBlock": 0, // ì²˜ìŒë¶€í„° PoS!

"shanghaiTime": 1696000704,

// PoW í¬í¬ëŠ” ëª¨ë‘ ìƒëµ

}

}

```

  

**ì„¤ê³„ ì² í•™:**

```

1. ì—­ì‚¬ ìƒëµ

"ìš°ë¦¬ëŠ” PoW ì—­ì‚¬ê°€ í•„ìš” ì—†ë‹¤"

â†’ ëª¨ë“  PoW í¬í¬ë¥¼ ë¸”ë¡ 0ì— ë°°ì¹˜

  

2. ë¹ ë¥¸ í…ŒìŠ¤íŠ¸

â†’ ë¸”ë¡ 0ë¶€í„° ëª¨ë“  PoW í¬í¬ê°€ í™œì„±í™”ë¨

â†’ ë¸”ë¡ 1ë¶€í„°ëŠ” PoSë§Œ í…ŒìŠ¤íŠ¸

  

3. ìµœì‹  í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜

â†’ Mainnetì˜ í˜„ì¬ ìƒíƒœ (PoS)ë¥¼ ì¦‰ì‹œ ê²½í—˜

â†’ PoW í™˜ê²½ì€ í…ŒìŠ¤íŠ¸ ë¶ˆí•„ìš”

```

  

#### Fork-ID í…ŒìŠ¤íŠ¸

  

```rust

// ëª¨ë“  í…ŒìŠ¤íŠ¸ì—ì„œ headëŠ” ì„ì˜ê°’ (123)

TestCase {

head: 123, // â† ë¬´ì‹œë¨ (PoSì´ë¯€ë¡œ)

time: 1696000704,

fork_id: ForkId {

fork_hash: 0xc61a6098, // PoW í¬í¬ ì „ë¶€ í¬í•¨

fork_next: 1707305664, // Cancun

},

is_valid: true,

},

```

  

### Sepolia: "PoW â†’ PoS ì „í™˜ ì‹œë®¬ë ˆì´ì…˜"

  

#### ì„¤ê³„ ì˜ë„

  

```

"PoWì™€ PoSë¥¼ ëª¨ë‘ ê²½í—˜í•˜ëŠ” í˜„ì‹¤ì ì¸ í…ŒìŠ¤íŠ¸ë„·"

```

  

#### íŠ¹ì§•

  

```json

{

"config": {

"homesteadBlock": 0, // ëª¨ë‘ 0 (ì˜ë¯¸ ì—†ìŒ)

"eip150Block": 0,

// ...

"mergeNetsplitBlock": 1735371, // ì‹¤ì œ ì˜ë¯¸ ìˆëŠ” ì²« í¬í¬

"shanghaiTime": 1677557088,

}

}

```

  

**ì„¤ê³„ ì² í•™:**

```

1. í˜„ì‹¤ì  ì²´ì¸ êµ¬ì¡°

"ìš°ë¦¬ë„ PoW â†’ PoS ì „í™˜ì„ ê±°ì³¤ë‹¤"

â†’ Merge ì‹œì ì´ ë¸”ë¡ 1735371

  

2. ë‘ ì˜ì—­ì˜ ê²½ê³„ í…ŒìŠ¤íŠ¸

PoW êµ¬ê°„ (ë¸”ë¡ 0 ~ 1735370)

â””â”€ ë¡œì§ìƒ ëª¨ë“  PoW í¬í¬ í™œì„±í™”ë˜ì–´ ìˆìŒ

  

PoS êµ¬ê°„ (ë¸”ë¡ 1735371+)

â””â”€ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ í¬í¬ í™œì„±í™”

  

3. ì‹¤ì œ ì „í™˜ ì½”ë“œ ê²€ì¦

"fork-id ê³„ì‚°ì´ ë¸”ë¡ ê¸°ë°˜ì—ì„œ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ìœ¼ë¡œ

ì˜¬ë°”ë¥´ê²Œ ì „í™˜ë˜ëŠ”ê°€?"

```

  

#### Fork-ID í…ŒìŠ¤íŠ¸ êµ¬ì„±

  

```rust

// PoW êµ¬ê°„: headê°€ ë³€í•¨

TestCase {

head: 0,

time: 0,

fork_id: ForkId { ..., fork_next: 1735371 }, // Merge

},

  

TestCase {

head: 1735370, // Merge ì§ì „

time: 0,

fork_id: ForkId { ..., fork_next: 1735371 }, // ì—¬ì „íˆ Merge

},

  

// PoS êµ¬ê°„: head ê³ ì •, time ë³€í•¨

TestCase {

head: 1735372, // â† ê³ ì • (ë¬´ì‹œë¨)

time: 1677557088, // â† Shanghai

fork_id: ForkId { ..., fork_next: 1706655072 }, // Cancun

},

```

  

### Mainnet: "ì™„ì „í•œ ì—­ì‚¬"

  

#### ì„¤ê³„ ì˜ë„

  

```

"Ethereumì˜ ëª¨ë“  ì—­ì‚¬ë¥¼ ê¸°ë¡í•œë‹¤"

```

  

#### íŠ¹ì§•

  

```json

{

"config": {

"homesteadBlock": 1150000, // ì˜ë¯¸ ìˆìŒ!

"eip150Block": 2463000, // ì˜ë¯¸ ìˆìŒ!

"eip155Block": 2675000, // ì˜ë¯¸ ìˆìŒ!

// ... 12ê°œ í¬í¬, ëª¨ë‘ ì˜ë¯¸ ìˆìŒ ...

"mergeNetsplitBlock": 17034870,

"shanghaiTime": 1681338455,

}

}

```

  

**ì„¤ê³„ ì² í•™:**

```

1. ì™„ì „í•œ ê¸°ë¡

"ìš°ë¦¬ëŠ” Homesteadë¶€í„° ì‹œì‘í–ˆë‹¤"

â†’ ëª¨ë“  í¬í¬ë¥¼ ì‹¤ì œ ë¸”ë¡ ë²ˆí˜¸ì— ê¸°ë¡

  

2. í¬í¬ íˆìŠ¤í† ë¦¬ ë³´ì¡´

ê° í¬í¬ë§ˆë‹¤ ê³ ìœ í•œ fork-id ê°’

â””â”€ ì—­ì‚¬ë¥¼ í†µí•´ í˜„ì¬ ìƒíƒœë¥¼ ì´í•´ ê°€ëŠ¥

  

3. í˜¸í™˜ì„± ê²€ì¦

"ì´ fork-id ê°’ì´ go-ethereumê³¼ ê°™ì€ê°€?"

â†’ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì™€ì˜ í˜¸í™˜ì„± ë³´ì¥

```

  

---

  

## í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„¤ê³„ ì›ë¦¬

  

### "ì™œ ì´ ì‹œì ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ”ê°€?"

  

#### ì›ë¦¬ 1: í¬í¬ í™œì„±í™” ê²½ê³„

  

```

í¬í¬ Xê°€ ë¸”ë¡ 1000ì—ì„œ í™œì„±í™”ëœë‹¤ë©´:

  

ë¸”ë¡ 999:

fork_hash = CRC32(genesis + ... + ì´ì „_í¬í¬ë“¤)

fork_next = 1000 (ë‹¤ìŒ í¬í¬)

  

ë¸”ë¡ 1000:

fork_hash = CRC32(genesis + ... + í¬í¬X) â† ë³€í•¨!

fork_next = ë‹¤ìŒ_í¬í¬

```

  

**í…ŒìŠ¤íŠ¸ ì „ëµ:**

```

ë¸”ë¡ 999ì™€ 1000ì„ ëª¨ë‘ í…ŒìŠ¤íŠ¸

â†’ fork-idê°€ ì •í™•í•˜ê²Œ ë³€í•˜ëŠ”ê°€ í™•ì¸

```

  

#### ì›ë¦¬ 2: íƒ€ì„ìŠ¤íƒ¬í”„ í¬í¬ì˜ ì—°ì†ì„±

  

```

íƒ€ì„ìŠ¤íƒ¬í”„ Xì—ì„œ í¬í¬ Y í™œì„±í™”:

  

ì‹œê°„ X-1ì´ˆ:

fork_hash = ì´ì „_ê°’

fork_next = X

  

ì‹œê°„ Xì´ˆ:

fork_hash = ë³€í•¨!

fork_next = ë‹¤ìŒ_í¬í¬

```

  

**í…ŒìŠ¤íŠ¸ ì „ëµ:**

```

ì‹œê°„ X-1ê³¼ Xë¥¼ ëª¨ë‘ í…ŒìŠ¤íŠ¸

â†’ í¬í¬ê°€ ì •í™•í•˜ê²Œ í™œì„±í™”ë˜ëŠ”ê°€ í™•ì¸

```

  

#### ì›ë¦¬ 3: "ì•„ì§ í™œì„±í™” ì•ˆ ëœ í¬í¬" ê²€ì¦

  

```

í¬í¬ê°€ ì•„ì§ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ì„ ë•Œ

fork_nextëŠ” ì •í™•í•˜ê²Œ "ë‹¤ìŒ í¬í¬ ì‹œì "ì„ ê°€ë¦¬ì¼œì•¼ í•¨

  

ì™œ?

â†’ ì›ê²© í”¼ì–´ê°€ ì´ ì •ë³´ë¥¼ ì‹ ë¢°í•˜ê³  í¬í¬ë¥¼ ì¤€ë¹„í•˜ê¸° ë•Œë¬¸

```

  

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìœ í˜•

  

#### ìœ í˜• 1: í¬í¬ ë°”ë¡œ ì§ì „

  

```rust

TestCase {

head: fork_block - 1, // ë˜ëŠ” time: fork_time - 1

fork_id: ForkId {

fork_hash: H32::from_str("0x...").unwrap(),

fork_next: fork_block, // â† "ë‹¤ìŒ í¬í¬ëŠ” ì—¬ê¸°"

},

is_valid: true,

},

```

  

**ê²€ì¦ ë‚´ìš©:**

```

[v] fork_hashê°€ ì •í™•í•œê°€? (ì´ì „ í¬í¬ë“¤ê¹Œì§€ë§Œ)

[v] fork_nextê°€ ì •í™•í•œê°€? (ë‹¤ìŒ í¬í¬ ì‹œì )

```

  

#### ìœ í˜• 2: í¬í¬ ë°”ë¡œ í›„

  

```rust

TestCase {

head: fork_block, // ë˜ëŠ” time: fork_time

fork_id: ForkId {

fork_hash: H32::from_str("0x...").unwrap(), // ë³€í•´ì•¼ í•¨

fork_next: next_fork_block, // ë‹¤ìŒ í¬í¬

},

is_valid: true,

},

```

  

**ê²€ì¦ ë‚´ìš©:**

```

[v] fork_hashê°€ ë³€í–ˆëŠ”ê°€? (ìƒˆ í¬í¬ í¬í•¨)

[v] fork_nextê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆëŠ”ê°€?

```

  

#### ìœ í˜• 3: í˜¸í™˜ì„± ê²€ì¦

  

```rust

TestCase {

head: current_block,

time: current_timestamp,

fork_id: ForkId {

fork_hash: remote_fork_id.hash,

fork_next: remote_fork_id.next,

},

is_valid: true, // ë˜ëŠ” false

},

```

  

**ê²€ì¦ ë‚´ìš©:**

```

[v] ì›ê²© í”¼ì–´ì˜ fork-idê°€ í˜¸í™˜ë˜ëŠ”ê°€?

[v] EIP-2124 ê²€ì¦ ê·œì¹™ì´ ì‘ë™í•˜ëŠ”ê°€?

```

  

---

  

## ì‹¤ì œ êµ¬í˜„: 0ìœ¼ë¡œ ì„¤ì •ëœ ë¸”ë¡ì˜ ì¸ì‹

  

### Sepoliaì˜ ì˜ˆì‹œ: "ì™œ homesteadBlock: 0ì¸ê°€?"

  

#### Genesis ì„¤ì •

  

```json

{

"config": {

"homesteadBlock": 0,

"eip150Block": 0,

"eip155Block": 0,

"byzantiumBlock": 0,

"constantinopleBlock": 0,

"petersburgBlock": 0,

"istanbulBlock": 0,

"berlinBlock": 0,

"londonBlock": 0,

"mergeNetsplitBlock": 1735371,

"shanghaiTime": 1677557088,

}

}

```

  

#### ì‹¤í–‰ ì‹œ í•´ì„

  

```rust

// ì²´ì¸ ì„¤ì • ë¡œë“œ ì‹œ

let config = genesis.config;

  

// í¬í¬ ì •ë³´ ìˆ˜ì§‘

let forks = config.gather_forks(genesis_header);

// ê²°ê³¼: [0, 0, 0, 0, 0, 0, 0, 0, 0, 1735371, ...]

  

// ì¤‘ë³µ ì œê±° ë° ì •ë ¬

let forks = forks.sort().deduplicate();

// ê²°ê³¼: [0, 1735371, 1677557088, ...]

// (0ì€ ì œë„¤ì‹œìŠ¤ì´ë¯€ë¡œ ë¬´ì‹œë˜ê±°ë‚˜, ë˜ëŠ” ì˜ë¯¸ ì—†ëŠ” ê°’)

```

  

#### Fork-ID ê³„ì‚°

  

```rust

// ForkId::new() í•¨ìˆ˜ (ì‹¤ì œ êµ¬í˜„, crates/common/types/fork_id.rs)

pub fn new(

chain_config: ChainConfig,

genesis_header: BlockHeader,

head_timestamp: u64,

head_block_number: u64,

) -> Self {

// 1. Genesis ì •ë³´ ì¶”ì¶œ

let genesis_hash = genesis_header.hash(); // Genesis ë¸”ë¡ì˜ í•´ì‹œê°’

  

// 2. ì²´ì¸ ì„¤ì •ì—ì„œ í¬í¬ ì •ë³´ ë¶„ë¥˜ (block-basedì™€ timestamp-basedë¡œ ë¶„ë¦¬)

let (block_number_based_forks, timestamp_based_forks) =

chain_config.gather_forks(genesis_header);

  

// 3. CRC32 í•´ì…” ì´ˆê¸°í™”

let mut fork_next;

let mut hasher = Hasher::new(); // crc32fast::Hasher (IEEE polynomial ì‚¬ìš©)

hasher.update(genesis_hash.as_bytes()); // Genesis í•´ì‹œë¡œ ì´ˆê¸°í™”

  

// 4. PoW ì‹œëŒ€: ë¸”ë¡ ë²ˆí˜¸ ê¸°ë°˜ í¬í¬ ì²˜ë¦¬

fork_next = update_checksum(block_number_based_forks, &mut hasher, head_block_number);

if fork_next > 0 {

// ë‹¤ìŒ í¬í¬ê°€ ìˆìœ¼ë©´ (ì•„ì§ Merge ì „) â†’ fork_hash ë°˜í™˜ í›„ ì¢…ë£Œ

let fork_hash = H32::from_slice(&hasher.finalize().to_be_bytes());

return Self { fork_hash, fork_next }; // â† Early return (ìµœì í™”)

}

  

// 5. PoS ì‹œëŒ€: íƒ€ì„ìŠ¤íƒí”„ ê¸°ë°˜ í¬í¬ ì²˜ë¦¬

// (fork_nextê°€ 0ì´ë¼ëŠ” ê²ƒì€ ëª¨ë“  PoW í¬í¬ë¥¼ í†µê³¼í–ˆë‹¤ëŠ” ì˜ë¯¸ = Merge ì´í›„)

fork_next = update_checksum(timestamp_based_forks, &mut hasher, head_timestamp);

  

// 6. ìµœì¢… fork_hash ê³„ì‚° ë° ë°˜í™˜

let fork_hash = H32::from_slice(&hasher.finalize().to_be_bytes());

Self { fork_hash, fork_next }

}

  

// ë„ìš°ë¯¸ í•¨ìˆ˜: update_checksum()

// í¬í¬ ë°°ì—´ì„ ìˆœíšŒí•˜ë©´ì„œ í˜„ì¬ headê¹Œì§€ í™œì„±í™”ëœ í¬í¬ë“¤ì„ CRC32ì— ëˆ„ì 

fn update_checksum(forks: Vec<u64>, hasher: &mut Hasher, head: u64) -> u64 {

let mut last_included = 0; // ë§ˆì§€ë§‰ìœ¼ë¡œ í¬í•¨ëœ í¬í¬ ë²ˆí˜¸ (ì¤‘ë³µ ë°©ì§€ìš©)

  

for activation in forks {

if activation <= head {

// ì´ í¬í¬ëŠ” ì´ë¯¸ í™œì„±í™”ë¨

  

// ì¤‘ë³µ ì œê±°: Constantinopleê³¼ PetersburgëŠ” ê°™ì€ ë¸”ë¡ ë²ˆí˜¸(7,280,000)ì—ì„œ í™œì„±í™”

// ë”°ë¼ì„œ ê°™ì€ ê°’ì„ ë‘ ë²ˆ í•´ì‹œí•˜ëŠ” ê²ƒì„ ë°©ì§€

if activation != last_included {

hasher.update(&activation.to_be_bytes()); // í¬í¬ ë¸”ë¡ ë²ˆí˜¸/íƒ€ì„ìŠ¤íƒí”„ ì¶”ê°€

last_included = activation; // í˜„ì¬ í¬í¬ ë²ˆí˜¸ ê¸°ë¡

}

} else {

// ì´ í¬í¬ëŠ” ì•„ì§ í™œì„±í™”ë˜ì§€ ì•ŠìŒ

// â†’ ë‹¤ìŒ ì˜ˆìƒ í¬í¬ë¥¼ fork_nextë¡œ ë°˜í™˜

return activation;

}

}

  

// ëª¨ë“  í¬í¬ë¥¼ í†µê³¼í–ˆë‹¤ë©´ 0 ë°˜í™˜ (= ë‹¤ìŒ í¬í¬ ë¯¸ì •)

0

}

  

// ===== Sepolia êµ¬ì²´ì  ì˜ˆì‹œ =====

// current_block = 0 ì¼ ë•Œì˜ ë™ì‘

//

// 1ë‹¨ê³„: gather_forks() ì‹¤í–‰

// ì…ë ¥: genesis.jsonì˜ ì²´ì¸ ì„¤ì •

// homesteadBlock: 0, eip150Block: 0, ... mergeNetsplitBlock: 1735371

// gather_forks() ë‚´ë¶€:

// - .flatten(): Option ì œê±° â†’ [0, 0, 0, ..., 1735371]

// - .dedup(): ì¤‘ë³µ ì œê±°

// - .retain(|b| b != 0): 0 í•„í„°ë§ â†’ [1735371]

// ì¶œë ¥: block_number_based_forks = [1735371]

//

// 2ë‹¨ê³„: update_checksum(block_number_based_forks=[1735371], head=0)

// - activation=1735371, head=0

// - 1735371 > 0? YES

// - fork_next = 1735371 ì¦‰ì‹œ ë°˜í™˜ (hasher ì—…ë°ì´íŠ¸ ì•ˆ í•¨)

//

// 3ë‹¨ê³„: fork_next > 0ì´ë¯€ë¡œ ì¦‰ì‹œ Self ë°˜í™˜ (timestamp-based í¬í¬ ì²˜ë¦¬ ì•ˆ í•¨)

//

// ìµœì¢… ê²°ê³¼:

// fork_hash = CRC32(genesis_hash) [= 0xfe3366e7 for Sepolia]

// fork_next = 1735371 (Merge ë¸”ë¡)

```

  

**í•µì‹¬:**

```

ëª¨ë“  ë¸”ë¡ í¬í¬ê°€ 0ì´ë©´:

â†’ ë¸”ë¡ 0ì—ì„œ ëª¨ë‘ í™œì„±í™”ë¨

â†’ ë”°ë¼ì„œ fork_next = ì²« ë²ˆì§¸ ë¹„-0 í¬í¬ (1735371)

â†’ ì´ê²ƒì´ Merge!

```

  

#### ì½”ë“œ ìˆ˜ì¤€ì˜ ë™ì‘

  

```rust

// gather_forks() í•¨ìˆ˜ (ì‹¤ì œ êµ¬í˜„, crates/common/types/genesis.rs)

// ëª©ì : ChainConfigì˜ ëª¨ë“  í¬í¬ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì—¬ block-basedì™€ timestamp-basedë¡œ ë¶„ë¥˜

pub fn gather_forks(&self, genesis_header: BlockHeader) -> (Vec<u64>, Vec<u64>) {

// ===== 1ë‹¨ê³„: Block-based í¬í¬ ìˆ˜ì§‘ =====

// PoW ì‹œëŒ€ì˜ í¬í¬ë“¤ (ë¸”ë¡ ë²ˆí˜¸ë¡œ í™œì„±í™”)

let mut block_number_based_forks: Vec<u64> = vec![

self.homestead_block, // ë¸”ë¡ 1,150,000

if self.dao_fork_support { self.dao_fork_block } else { None }, // ì¡°ê±´ë¶€ (ETCëŠ” ë¯¸í¬í•¨)

self.eip150_block, // ë¸”ë¡ 2,463,000

self.eip155_block, // ë¸”ë¡ 2,675,000

self.eip158_block, // ë¸”ë¡ 2,675,000 (ì¤‘ë³µ ê°€ëŠ¥)

self.byzantium_block, // ë¸”ë¡ 4,370,000

self.constantinople_block, // ë¸”ë¡ 7,280,000

self.petersburg_block, // ë¸”ë¡ 7,280,000 (ì¤‘ë³µ)

self.istanbul_block, // ë¸”ë¡ 9,069,000

self.muir_glacier_block, // ë¸”ë¡ 9,200,000

self.berlin_block, // ë¸”ë¡ 12,244,000

self.london_block, // ë¸”ë¡ 12,965,000

self.arrow_glacier_block, // ë¸”ë¡ 13,773,000

self.gray_glacier_block, // ë¸”ë¡ 15,050,000

self.merge_netsplit_block, // ë¸”ë¡ 17,034,870 (PoS ì „í™˜)

]

.into_iter()

.flatten() // Option íƒ€ì… ì œê±° (Noneì€ ë²„ë¦¼, Some(x)ëŠ” xë¡œ ë³€í™˜)

.collect();

  

// ì •ë ¬ ë° ì¤‘ë³µ ì œê±°

// ì´ìœ : Constantinopleê³¼ Petersburgì²˜ëŸ¼ ê°™ì€ ë¸”ë¡ ë²ˆí˜¸ì—ì„œ í™œì„±í™”ë˜ëŠ” í¬í¬ ì œê±°

block_number_based_forks.sort(); // ë¸”ë¡ ë²ˆí˜¸ ìˆœì„œëŒ€ë¡œ ì •ë ¬

block_number_based_forks.dedup(); // ì—°ì†ëœ ì¤‘ë³µê°’ ì œê±°

  

// ===== 2ë‹¨ê³„: Timestamp-based í¬í¬ ìˆ˜ì§‘ =====

// PoS ì‹œëŒ€ì˜ í¬í¬ë“¤ (íƒ€ì„ìŠ¤íƒí”„ë¡œ í™œì„±í™”, Merge ì´í›„ë§Œ)

let mut timestamp_based_forks: Vec<u64> = vec![

self.shanghai_time, // íƒ€ì„ìŠ¤íƒí”„ 1681338455 (2023-04-12)

self.cancun_time, // íƒ€ì„ìŠ¤íƒí”„ 1710338135 (2024-03-13)

self.prague_time, // íƒ€ì„ìŠ¤íƒí”„ 1746612311 (2025-01-07)

self.osaka_time, // íƒ€ì„ìŠ¤íƒí”„ 1764798551 (2025-10-05)

self.bpo1_time, // íƒ€ì„ìŠ¤íƒí”„ 1765290071 (2025-10-09)

self.bpo2_time, // íƒ€ì„ìŠ¤íƒí”„ 1767747671 (2025-11-07)

// ... (ê³„ì†) BPO3, BPO4, BPO5, Amsterdam, Verkle ë“±

]

.into_iter()

.flatten() // Option ì œê±°

.collect();

  

// ì •ë ¬ ë° ì¤‘ë³µ ì œê±° (timestampë„ ë™ì¼í•œ ë¡œì§)

timestamp_based_forks.sort();

timestamp_based_forks.dedup();

  

// ===== 3ë‹¨ê³„: Genesis ì´ì „ í¬í¬ í•„í„°ë§ =====

// "0"ìœ¼ë¡œ ì„¤ì •ëœ í¬í¬ ì œê±° (ì œë„¤ì‹œìŠ¤ ë¸”ë¡ì€ ë¸”ë¡ 0ì´ë¯€ë¡œ ì˜ë¯¸ ì—†ìŒ)

block_number_based_forks.retain(|block_number| {

*block_number != 0 // ë¸”ë¡ 0ì€ ì œê±° (ì˜ë¯¸ ì—†ëŠ” ê°’)

});

  

// Genesis íƒ€ì„ìŠ¤íƒí”„ ì´ì „ì˜ íƒ€ì„ìŠ¤íƒí”„ í¬í¬ ì œê±°

// ì˜ˆ: Genesis íƒ€ì„ìŠ¤íƒí”„ê°€ 1677557088ì´ë©´, ê·¸ ì´ì „ì˜ ëª¨ë“  forkëŠ” ë¬´ì˜ë¯¸

timestamp_based_forks.retain(|block_timestamp| {

*block_timestamp > genesis_header.timestamp

});

  

// ===== 4ë‹¨ê³„: ê²°ê³¼ ë°˜í™˜ =====

// (block-based í¬í¬ ë°°ì—´, timestamp-based í¬í¬ ë°°ì—´)

(block_number_based_forks, timestamp_based_forks)

}

```

  

**Sepolia ì˜ˆì‹œ:**

```

Genesis ì„¤ì • (genesis.json):

â”œâ”€ homesteadBlock: 0

â”œâ”€ eip150Block: 0

â”œâ”€ mergeNetsplitBlock: 1735371

â””â”€ shanghaiTime: 1677557088

  

gather_forks() ì‹¤í–‰:

1. ëª¨ë“  í¬í¬ ìˆ˜ì§‘: [None, None, None, ..., 1735371]

2. flatten(): [1735371]

3. retain(|b| b != 0): [1735371] // 0 ëª¨ë‘ ì œê±°ë¨

  

ê²°ê³¼:

block_number_based_forks = [1735371]

timestamp_based_forks = [1677557088, ...]

```

  

**ë”°ë¼ì„œ:**

```

Sepoliaì—ì„œ:

- ë¸”ë¡ 0 ~ 1735370: ëª¨ë“  PoW í¬í¬ê°€ í™œì„±í™”ëœ ìƒíƒœ (ë¡œì§ìƒ)

â†’ ì¡°ê±´: fork <= head â†’ ëª¨ë“  0ì´ ì•„ë‹Œ í¬í¬ëŠ” 1735371ì´ë¯€ë¡œ > head(0)

â†’ fork_next = 1735371 (Merge)

  

- ë¸”ë¡ 1735371+: PoS ì˜ì—­, timestamp ê¸°ë°˜ í¬í¬ í™œì„±í™”

â†’ head: 1735372ì¼ ë•Œ, timestampë¡œ íŒë‹¨

â†’ timestamp 1677557088 (Shanghai) ë„ë‹¬ ì‹œ fork_hash ë³€í•¨

```

  

---

  

## Mainnet ì—­ì‚¬ì™€ í¬í¬ ìˆœì„œ

  

### ì™„ì „í•œ í¬í¬ íƒ€ì„ë¼ì¸

  

```

2015ë…„ 7ì›” 30ì¼

â”œâ”€ Genesis (ë¸”ë¡ 0, íƒ€ì„ìŠ¤íƒ¬í”„ 0)

â”‚ fork_hash = CRC32(genesis)

â”‚ fork_next = 1150000 (Homestead)

â”‚

â””â”€ 1ë…„ 10ê°œì›” í›„...

  

2016ë…„ 3ì›” 14ì¼

â”œâ”€ Homestead (ë¸”ë¡ 1,150,000)

â”‚ ê·œì¹™ ë³€í™”: ê°€ìŠ¤ ë¹„ìš© ì¡°ì •, ë‚œì´ë„ í­íƒ„ ë„ì…

â”‚ fork_hash = CRC32(genesis + 1150000)

â”‚ fork_next = 1920000 (DAO Fork)

â”‚

â””â”€ 1ê°œì›” í›„...

  

2016ë…„ 7ì›” 20ì¼

â”œâ”€ DAO Fork (ë¸”ë¡ 1,920,000)

â”‚ ê·œì¹™ ë³€í™”: DAO í•´í‚¹ìœ¼ë¡œ ì¸í•œ ë„¤íŠ¸ì›Œí¬ ë¶„ì—´ íšŒë³µ

â”‚ fork_hash = CRC32(genesis + 1150000 + 1920000)

â”‚ fork_next = 2463000 (EIP150)

â”‚ ì´ í¬í¬ë¡œ ì¸í•´ Ethereum Classic(ETC) ë¶„ì—´

â”‚

â””â”€ 5ê°œì›” í›„...

  

2016ë…„ 10ì›” 18ì¼

â”œâ”€ EIP150 / Tangerine Whistle (ë¸”ë¡ 2,463,000)

â”‚ ê·œì¹™ ë³€í™”: ê°€ìŠ¤ ë¹„ìš© ì¬ì¡°ì •, ì„±ëŠ¥ ê°œì„ 

â”‚ fork_hash = CRC32(genesis + ... + 2463000)

â”‚ fork_next = 2675000 (EIP155/158)

â”‚

â””â”€ 1ê°œì›” í›„...

  

2016ë…„ 11ì›” 22ì¼

â”œâ”€ EIP155/158 / Spurious Dragon (ë¸”ë¡ 2,675,000)

â”‚ ê·œì¹™ ë³€í™”: ë¦¬í”Œë ˆì´ ê³µê²© ë°©ì–´, ìì²´ íŒŒê´´ opcode ì¶”ê°€

â”‚ fork_hash = CRC32(genesis + ... + 2675000)

â”‚ fork_next = 4370000 (Byzantium)

â”‚

â””â”€ 1ë…„ 4ê°œì›” í›„...

  

2017ë…„ 10ì›” 16ì¼

â”œâ”€ Byzantium (ë¸”ë¡ 4,370,000)

â”‚ ê·œì¹™ ë³€í™”:

â”‚ â”œâ”€ zk-SNARK ì§€ì›

â”‚ â”‚ â”œâ”€ Precompile 0x06: EC ì  ì¶”ê°€ (ecAdd)

â”‚ â”‚ â”œâ”€ Precompile 0x07: EC ìŠ¤ì¹¼ë¼ ê³±ì…ˆ (ecMul)

â”‚ â”‚ â””â”€ Precompile 0x08: Pairing ê²€ì¦ (ecPairing)

â”‚ â”‚ â””â”€ ëª©ì : zk-SNARK ê²€ì¦ íš¨ìœ¨í™” (L2 ì†”ë£¨ì…˜ ê¸°ì´ˆ)

â”‚ â”œâ”€ ë¸”ë¡ ë³´ìƒ: 3ETH â†’ 2ETH ê°ì†Œ

â”‚ â””â”€ ë¦¬ì›Œë“œ ì •ì±… ë³€í™” (ì¸í”Œë ˆì´ì…˜ ê´€ë¦¬)

â”‚ fork_hash = CRC32(genesis + ... + 4370000)

â”‚ fork_next = 7280000 (Constantinople)

â”‚

â””â”€ 2ë…„ 5ê°œì›” í›„...

  

2019ë…„ 2ì›” 28ì¼

â”œâ”€ Constantinople (ë¸”ë¡ 7,280,000)

â”‚ ê·œì¹™ ë³€í™”: CREATE2, REVERT opcode ì¶”ê°€

â”‚ fork_hash = CRC32(genesis + ... + 7280000)

â”‚ fork_next = 9069000 (Istanbul)

â”‚

â”‚ ë¬¸ì œ: Constantinople ë°°í¬ ì§í›„ ë‚œì´ë„ í­íƒ„ ê³„ì‚° ë²„ê·¸ ë°œê²¬

â”‚ (ë‚œì´ë„ í­íƒ„ì´ ì˜ˆìƒë³´ë‹¤ ë¹ ë¥´ê²Œ ì¦ê°€)

â”‚

â””â”€ ì¦‰ì‹œ í›„...

  

2019ë…„ 2ì›” 28ì¼

â”œâ”€ Petersburg (ë¸”ë¡ 7,280,000) (ê°™ì€ ë¸”ë¡)

â”‚ ê·œì¹™ ë³€í™”: Constantinopleì˜ ë‚œì´ë„ í­íƒ„ ë²„ê·¸ ìˆ˜ì •

â”‚

â”‚ ì£¼ì˜: Constantinopleê³¼ PetersburgëŠ” ê°™ì€ ë¸”ë¡ ë²ˆí˜¸ 7,280,000ì—ì„œ

â”‚ í™œì„±í™”ë˜ì–´ ë™ì¼í•œ fork_hashì™€ fork_nextë¥¼ ê°€ì§‘ë‹ˆë‹¤.

â”‚ (Constantinopleì˜ bug fixì´ê¸° ë•Œë¬¸)

â”‚

â”‚ fork_hash = CRC32(genesis + ... + 7280000) (Constantinopleê³¼ ë™ì¼)

â”‚ fork_next = 9069000 (Istanbul)

â”‚

â””â”€ 1ë…„ 5ê°œì›” í›„...

  

2019ë…„ 12ì›” 8ì¼

â”œâ”€ Istanbul (ë¸”ë¡ 9,069,000)

â”‚ ê·œì¹™ ë³€í™”: ê°€ìŠ¤ ë¹„ìš© ì¬ì¡°ì •, ìƒˆë¡œìš´ precompiles

â”‚ fork_hash = CRC32(genesis + ... + 9069000)

â”‚ fork_next = 9200000 (Muir Glacier)

â”‚

â””â”€ 1ê°œì›” í›„...

  

2020ë…„ 1ì›” 2ì¼

â”œâ”€ Muir Glacier (ë¸”ë¡ 9,200,000)

â”‚ ê·œì¹™ ë³€í™”: ë‚œì´ë„ í­íƒ„ ì¬ì—°ê¸°

â”‚ PoS Merge ì¤€ë¹„ë¥¼ ìœ„í•´ PoWë¥¼ ê³„ì† ìœ ì§€

â”‚ fork_hash = CRC32(genesis + ... + 9200000)

â”‚ fork_next = 12244000 (Berlin)

â”‚

â””â”€ 2ë…„ í›„...

  

2021ë…„ 4ì›” 15ì¼

â”œâ”€ Berlin (ë¸”ë¡ 12,244,000)

â”‚ ê·œì¹™ ë³€í™”: EIP-2930 (access lists), ê°€ìŠ¤ ë¹„ìš© ì¡°ì •

â”‚ fork_hash = CRC32(genesis + ... + 12244000)

â”‚ fork_next = 12965000 (London)

â”‚

â””â”€ 2ê°œì›” í›„...

  

2021ë…„ 8ì›” 5ì¼

â”œâ”€ London (ë¸”ë¡ 12,965,000)

â”‚ ê·œì¹™ ë³€í™”: EIP-1559 (ê¸°ë³¸ ìˆ˜ìˆ˜ë£Œ ì†Œê°), ë¸”ë¡ ë³´ìƒ 2ETH â†’ 2ETH

â”‚ Ethereum ê²½ì œ êµ¬ì¡° ë³€í™” (ë§ˆì´ë„ˆ â†’ ìŠ¤í…Œì´ì»¤ ìˆ˜ìµ)

â”‚ fork_hash = CRC32(genesis + ... + 12965000)

â”‚ fork_next = 13773000 (Arrow Glacier)

â”‚

â””â”€ 1ë…„ í›„...

  

2022ë…„ 6ì›” 17ì¼

â”œâ”€ Arrow Glacier (ë¸”ë¡ 13,773,000)

â”‚ ê·œì¹™ ë³€í™”: ë‚œì´ë„ í­íƒ„ ì¬ì—°ê¸°

â”‚ fork_hash = CRC32(genesis + ... + 13773000)

â”‚ fork_next = 15050000 (Gray Glacier)

â”‚

â””â”€ 2ê°œì›” í›„...

  

2022ë…„ 9ì›” 6ì¼

â”œâ”€ Gray Glacier (ë¸”ë¡ 15,050,000)

â”‚ ê·œì¹™ ë³€í™”: ë‚œì´ë„ í­íƒ„ ë§ˆì§€ë§‰ ì—°ê¸°

â”‚ fork_hash = CRC32(genesis + ... + 15050000)

â”‚ fork_next = 17034870 (Merge)

â”‚

â””â”€ 9ì¼ í›„...

  

2022ë…„ 9ì›” 15ì¼ (ë¸”ë¡ 17,034,870)

â”œâ”€ Merge (The Transition)

â”‚ ê·œì¹™ ë³€í™”:

â”‚ â”œâ”€ PoW ì±„êµ´ ì¢…ë£Œ

â”‚ â”œâ”€ PoS ê²€ì¦ì ì‹œì‘

â”‚ â”œâ”€ ë¸”ë¡ íƒ€ì„ 13ì´ˆ â†’ 12ì´ˆ

â”‚ â”œâ”€ ë¸”ë¡ ìƒì„± ì‹œê°„ ë¶ˆê·œì¹™ â†’ ì •í™•

â”‚ â”œâ”€ Fork-ID ê¸°ì¤€ ë³€ê²½: ë¸”ë¡ â†’ íƒ€ì„ìŠ¤íƒ¬í”„

â”‚ â””â”€ Beacon Chainì´ ë©”ì¸ ì²´ì¸ì´ ë¨

â”‚ fork_hash = CRC32(genesis + ... + 17034870)

â”‚ fork_next = 1681338455 (Shanghai) (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)

â”‚

â””â”€ 6ê°œì›” í›„... (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)

  

2023ë…„ 4ì›” 12ì¼

â”œâ”€ Shanghai (íƒ€ì„ìŠ¤íƒ¬í”„ 1681338455)

â”‚ ê·œì¹™ ë³€í™”: Staking ì¸ì¶œ í™œì„±í™” (ETH ìŠ¤í…Œì´í‚¹ í™•ëŒ€)

â”‚ fork_hash = CRC32(genesis + ... + 1681338455)

â”‚ fork_next = 1710338135 (Cancun)

â”‚

â””â”€ 11ê°œì›” í›„...

  

2024ë…„ 3ì›” 13ì¼

â”œâ”€ Cancun (íƒ€ì„ìŠ¤íƒ¬í”„ 1710338135)

â”‚ ê·œì¹™ ë³€í™”: EIP-4844 (Proto-Danksharding, Blob)

â”‚ fork_hash = CRC32(genesis + ... + 1710338135)

â”‚ fork_next = 1746612311 (Prague)

â”‚

â””â”€ 9ê°œì›” í›„...

  

2025ë…„ 1ì›” 7ì¼

â”œâ”€ Prague (íƒ€ì„ìŠ¤íƒ¬í”„ 1746612311)

â”‚ ê·œì¹™ ë³€í™”: EOF (Ethereum Object Format), ì—¬ëŸ¬ EIP

â”‚ fork_hash = CRC32(genesis + ... + 1746612311)

â”‚ fork_next = 1764798551 (Osaka)

â”‚

â””â”€ 9ê°œì›” í›„...

  

2025ë…„ 10ì›” 5ì¼

â”œâ”€ Osaka (íƒ€ì„ìŠ¤íƒ¬í”„ 1764798551)

â”‚ ê·œì¹™ ë³€í™”: ë‹¤ì–‘í•œ L2 ê°œì„ 

â”‚ fork_hash = CRC32(genesis + ... + 1764798551)

â”‚ fork_next = 1765290071 (BPO1)

â”‚

â””â”€ 4ì¼ í›„...

  

2025ë…„ 10ì›” 9ì¼

â”œâ”€ BPO1 (íƒ€ì„ìŠ¤íƒ¬í”„ 1765290071)

â”‚ ê·œì¹™ ë³€í™”: ...

â”‚ fork_hash = CRC32(genesis + ... + 1765290071)

â”‚ fork_next = 1767747671 (BPO2)

â”‚

â””â”€ 29ì¼ í›„...

  

2025ë…„ 11ì›” 7ì¼

â”œâ”€ BPO2 (íƒ€ì„ìŠ¤íƒ¬í”„ 1767747671)

â”‚ ê·œì¹™ ë³€í™”: ...

â”‚ fork_hash = CRC32(genesis + ... + 1767747671)

â”‚ fork_next = 0 (ë‹¤ìŒ í¬í¬ ë¯¸ì •)

â”‚

â””â”€ ... ê³„ì†

```

  

### í¬í¬ì˜ ì§„í™”

  

**ì´ˆê¸° (2015-2017):**

```

ì§§ì€ ê°„ê²©, ë¹ ë¥¸ ë³€í™”

Homestead â†’ DAO â†’ EIP150 â†’ EIP155 â†’ Byzantium

(ê°ê° 1~2ê°œì›”)

```

  

**ì¤‘ê¸° (2017-2019):**

```

ì ì°¨ ê¸¸ì–´ì§€ëŠ” ê°„ê²©, ì•ˆì •í™”

Byzantium â†’ Constantinople/Petersburg â†’ Istanbul

(ê°ê° ìˆ˜ê°œì›”~1ë…„)

```

  

**í›„ê¸° (2019-2022):**

```

PoW ìœ ì§€, PoS ì¤€ë¹„

Istanbul â†’ Muir Glacier â†’ Berlin â†’ London â†’ Arrow Glacier â†’ Gray Glacier

(ê°ê° ìˆ˜ê°œì›”, ë‚œì´ë„ í­íƒ„ ê´€ë¦¬)

```

  

**PoS ì‹œëŒ€ (2022-í˜„ì¬):**

```

íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜, ì •ê¸°ì  ì—…ê·¸ë ˆì´ë“œ

Merge â†’ Shanghai â†’ Cancun â†’ Prague â†’ ...

(ì•½ 6-9ê°œì›” ê°„ê²©)

```

  

---

  

## Mainnet í…ŒìŠ¤íŠ¸ êµ¬í˜„

  

### í…ŒìŠ¤íŠ¸ ì„¤ê³„ ì›ë¦¬

  

ê¸°ì¡´ Sepoliaì™€ Holesky í…ŒìŠ¤íŠ¸ì™€ ìœ ì‚¬í•˜ê²Œ, Mainnet í…ŒìŠ¤íŠ¸ëŠ” genesis.jsonì—ì„œ ì²´ì¸ ì„¤ì •ì„ ì½ê³  ì£¼ìš” í¬í¬ ì‹œì ì—ì„œ fork-id ê°’ì„ ê²€ì¦í•©ë‹ˆë‹¤.

  

**í…ŒìŠ¤íŠ¸ êµ¬ì¡°:**

```rust

#[test]

fn mainnet_test_cases() {

let genesis: Genesis = read_genesis_json();

let test_cases: Vec<TestCase> = vec![

// PoW êµ¬ê°„ í…ŒìŠ¤íŠ¸

// PoS êµ¬ê°„ í…ŒìŠ¤íŠ¸

];

assert_test_cases(test_cases, genesis.config, genesis_header);

}

```

  

### PoW êµ¬ê°„ í…ŒìŠ¤íŠ¸ (ë¸”ë¡ ê¸°ë°˜)

  

Genesisë¶€í„° Gray Glacierê¹Œì§€ì˜ í…ŒìŠ¤íŠ¸ëŠ” head (ë¸”ë¡ ë²ˆí˜¸)ë¥¼ ë³€ê²½í•˜ë©° fork_hashì˜ ë³€í™”ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.

  

**Genesis:**

```rust

TestCase {

head: 0,

time: 0,

fork_id: ForkId {

fork_hash: H32::from_str("0xfc64ec04").unwrap(),

fork_next: 1150000, // Homestead

},

is_valid: true,

},

```

  

**Homestead ì§ì „ê³¼ ì§í›„:**

```rust

// ë¸”ë¡ 1149999: Homestead ì§ì „

TestCase {

head: 1149999,

time: 0,

fork_id: ForkId {

fork_hash: H32::from_str("0xfc64ec04").unwrap(),

fork_next: 1150000,

},

is_valid: true,

},

  

// ë¸”ë¡ 1150000: Homestead í™œì„±í™”

TestCase {

head: 1150000,

time: 0,

fork_id: ForkId {

fork_hash: H32::from_str("0x97c2c34c").unwrap(), // ë³€í•¨

fork_next: 1920000, // DAO

},

is_valid: true,

},

```

  

ì£¼ìš” PoW í¬í¬ë“¤ (DAO, EIP150, Byzantium, Istanbul, Berlin, London)ë„ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. ê° í¬í¬ì—ì„œ fork_hashëŠ” ì´ì „ í¬í¬ë“¤ì˜ ë¸”ë¡ ë²ˆí˜¸ë¥¼ ëˆ„ì í•´ì„œ CRC32ë¡œ ê³„ì‚°í•œ ìƒˆë¡œìš´ ê°’ì´ ë˜ê³ , fork_nextëŠ” ë‹¤ìŒ í¬í¬ì˜ ë¸”ë¡ ë²ˆí˜¸ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤.

  

**Gray Glacier (ë§ˆì§€ë§‰ PoW í¬í¬, ë¸”ë¡ 15,050,000):**

```rust

TestCase {

head: 15050000,

time: 0,

fork_id: ForkId {

fork_hash: H32::from_str("0xf0afd0e3").unwrap(),

fork_next: 17034870, // Merge

},

is_valid: true,

},

```

  

### PoS êµ¬ê°„ í…ŒìŠ¤íŠ¸ (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)

  

Merge (ë¸”ë¡ 17,034,870)ë¶€í„° ì‹œì‘í•´ì„œ time (íƒ€ì„ìŠ¤íƒ¬í”„) íŒŒë¼ë¯¸í„°ê°€ fork-id ê³„ì‚°ì„ ê²°ì •í•©ë‹ˆë‹¤. head íŒŒë¼ë¯¸í„°ëŠ” fork-id ê³„ì‚°ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.

  

**Merge ì „í™˜:**

```rust

// Merge ì§ì „: ì—¬ì „íˆ Gray Glacier ìƒíƒœ

TestCase {

head: 17034870,

time: 1681338454, // Shanghai ì§ì „

fork_id: ForkId {

fork_hash: H32::from_str("0xf0afd0e3").unwrap(), // Gray Glacier

fork_next: 1681338455, // Shanghai

},

is_valid: true,

},

  

// Shanghai í™œì„±í™” (ì²« PoS í¬í¬)

TestCase {

head: 17034870, // headëŠ” ë¬´ì‹œë¨

time: 1681338455, // íƒ€ì„ìŠ¤íƒ¬í”„ë§Œ ì¤‘ìš”

fork_id: ForkId {

fork_hash: H32::from_str("0xdce96c2d").unwrap(), // ë³€í•¨

fork_next: 1710338135, // Cancun

},

is_valid: true,

},

```

  

**Cancun, Prague ë“± PoS í¬í¬ë“¤:**

```rust

// Cancun (íƒ€ì„ìŠ¤íƒ¬í”„ 1710338135)

TestCase {

head: 18000000, // headëŠ” ì˜ë¯¸ ì—†ìŒ

time: 1710338135,

fork_id: ForkId {

fork_hash: H32::from_str("0x9f3d2254").unwrap(),

fork_next: 1746612311, // Prague

},

is_valid: true,

},

  

// Prague (íƒ€ì„ìŠ¤íƒ¬í”„ 1746612311)

TestCase {

head: 19000000,

time: 1746612311,

fork_id: ForkId {

fork_hash: H32::from_str("0xc376cf8b").unwrap(),

fork_next: 1764798551, // Osaka

},

is_valid: true,

},

```

  

### ë¯¸ë˜ ìƒíƒœ ê²€ì¦

  

ìµœì‹  í¬í¬ ì´í›„ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ì—ì„œë„ fork-idê°€ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤:

  

```rust

// BPO2 (ìµœì‹ , íƒ€ì„ìŠ¤íƒ¬í”„ 1767747671)

TestCase {

head: 20000000,

time: 1767747671,

fork_id: ForkId {

fork_hash: H32::from_str("0x07c9462e").unwrap(),

fork_next: 0, // ë‹¤ìŒ í¬í¬ ë¯¸ì •

},

is_valid: true,

},

  

// ë¯¸ë˜ ì‹œì 

TestCase {

head: 25000000,

time: 2000000000,

fork_id: ForkId {

fork_hash: H32::from_str("0x07c9462e").unwrap(), // ìœ ì§€

fork_next: 0,

},

is_valid: true,

},

```

  

### í…ŒìŠ¤íŠ¸ ê²€ì¦ í¬ì¸íŠ¸

  

ì‹¤ì œ êµ¬í˜„ëœ mainnet_test_cases()ì—ì„œ ê²€ì¦í•˜ëŠ” ì‚¬í•­:

  

- Genesis fork_hash (0xfc64ec04)ì™€ go-ethereumì˜ ê°’ì´ ì¼ì¹˜

- PoW êµ¬ê°„ì—ì„œ ê° í¬í¬ í™œì„±í™” ì‹œì ì— fork_hash ë³€ê²½

- Gray Glacierì—ì„œ fork_nextê°€ Merge ë¸”ë¡ ë²ˆí˜¸ (17034870)

- Merge ì´í›„ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ ì „í™˜

- PoS í¬í¬ë“¤ì˜ fork_hashê°€ go-ethereumì˜ ê°’ê³¼ ì¼ì¹˜ (Shanghai: 0xdce96c2d, Cancun: 0x9f3d2254, Prague: 0xc376cf8b ë“±)

- ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ is_valid: trueë¡œ í˜¸í™˜ì„± ê²€ì¦

  

---

  

## ê²°ë¡ 

  

### Fork-IDì˜ ì—¬ì •

  

```

2015: Ethereum ì‹œì‘ (ë¸”ë¡ ê¸°ë°˜)

â†“

2016-2019: ì—¬ëŸ¬ í¬í¬, PoW ì§„í–‰

â†“

2019-2022: PoS ì¤€ë¹„, ë‚œì´ë„ í­íƒ„ ê´€ë¦¬

â†“

2022ë…„ 9ì›”: The Merge (PoW â†’ PoS)

â†“

í˜„ì¬: PoS ì‹œëŒ€, ì •ê¸°ì  ì—…ê·¸ë ˆì´ë“œ

â†“

ë¯¸ë˜: ë” í™•ì¥ëœ ë„¤íŠ¸ì›Œí¬

```

  

### ê¸°ìˆ ì  ì§„í™”

  

```

PoW ì‹œëŒ€:

- ë¶ˆê·œì¹™í•œ ë¸”ë¡ ìƒì„±

- ë¸”ë¡ ë²ˆí˜¸ ê¸°ë°˜ í¬í¬

- Fork-ID = CRC32(genesis + activated_blocks)

  

PoS ì‹œëŒ€:

- ì •í™•í•œ 12ì´ˆ ë¸”ë¡ íƒ€ì„

- íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ í¬í¬

- Fork-ID = CRC32(genesis + activated_timestamps)

```

  

### í…ŒìŠ¤íŠ¸ì˜ ì˜ë¯¸

  

```

Holesky: "ìš°ë¦¬ëŠ” PoS í™˜ê²½ë§Œ í•„ìš”í•˜ë‹¤"

Sepolia: "ìš°ë¦¬ëŠ” PoW â†’ PoS ì „í™˜ì„ ì‹œë®¬ë ˆì´ì…˜í•œë‹¤"

Mainnet: "ìš°ë¦¬ëŠ” ì™„ì „í•œ ì—­ì‚¬ë¥¼ ê¸°ë¡í•œë‹¤"

  

Mainnet í…ŒìŠ¤íŠ¸ ì¶”ê°€:

â†’ Go-Ethereumê³¼ì˜ í˜¸í™˜ì„± ë³´ì¥

â†’ ë¸”ë¡ ê¸°ë°˜ê³¼ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ ëª¨ë‘ ê²€ì¦

â†’ 9ë…„ ì—­ì‚¬ì˜ ì •í™•ì„± í™•ë³´

```

  

---

  

## is_valid ê²€ì¦ ë¡œì§ ë¶„ì„

  

### ê°œìš”

  

`is_valid()` í•¨ìˆ˜ëŠ” ì›ê²© í”¼ì–´ì˜ Fork-IDê°€ ë¡œì»¬ ë…¸ë“œì™€ í˜¸í™˜ë˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤. EIP-2124ì—ì„œ ì •ì˜í•œ 4ê°€ì§€ ê²€ì¦ ê·œì¹™ì„ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©í•©ë‹ˆë‹¤.

  

### í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜

  

```rust

pub fn is_valid(

&self, // ë¡œì»¬ Fork-ID

remote: Self, // ì›ê²© í”¼ì–´ì˜ Fork-ID

latest_block_number: u64, // ë¡œì»¬ì˜ ìµœì‹  ë¸”ë¡ ë²ˆí˜¸

head_timestamp: u64, // ë¡œì»¬ì˜ ìµœì‹  íƒ€ì„ìŠ¤íƒ¬í”„

chain_config: ChainConfig, // ì²´ì¸ ì„¤ì •

genesis_header: BlockHeader,// Genesis í—¤ë”

) -> bool

```

  

### ê²€ì¦ íë¦„

  

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ is_valid() ì‹¤í–‰ ì‹œì‘ â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 1. head ê°’ ê²°ì • â”‚

â”‚ head_timestamp >= TIMESTAMP_THRESHOLD (1438269973)? â”‚

â”‚ â†’ YES: head = head_timestamp (PoS ëª¨ë“œ) â”‚

â”‚ â†’ NO: head = latest_block_number (PoW ëª¨ë“œ) â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 2. ê·œì¹™ #1: fork_hash ì¼ì¹˜ ê²€ì‚¬ â”‚

â”‚ remote.fork_hash == self.fork_hash? â”‚

â”‚ â†’ YES: fork_next ê²€ì¦ â”‚

â”‚ - remote.fork_next <= head && != 0? â†’ false â”‚

â”‚ - ê·¸ ì™¸ â†’ true â”‚

â”‚ â†’ NO: ê·œì¹™ #2, #3, #4ë¡œ ì§„í–‰ â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 3. ëª¨ë“  ìœ íš¨í•œ Fork-ID ì¡°í•© ìƒì„± â”‚

â”‚ valid_combinations = get_all_fork_id_combinations() â”‚

â”‚ [(hash_0, fork_0), (hash_1, fork_1), ..., (hash_n, 0)] â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 4. ì¡°í•© ìˆœíšŒí•˜ë©° ê·œì¹™ #2, #3 ê²€ì‚¬ â”‚

â”‚ â”‚

â”‚ is_subset = true (ë¡œì»¬ë³´ë‹¤ ê³¼ê±° ìƒíƒœ ê²€ì‚¬) â”‚

â”‚ â”‚

â”‚ for (fork_hash, fork_next) in valid_combinations: â”‚

â”‚ â”‚ â”‚

â”‚ â”œâ”€ if is_subset: â”‚

â”‚ â”‚ ê·œì¹™ #2: remoteê°€ ë¡œì»¬ì˜ ë¶€ë¶„ì§‘í•©? â”‚

â”‚ â”‚ remote.fork_hash == fork_hash && â”‚

â”‚ â”‚ remote.fork_next == fork_next â†’ return true â”‚

â”‚ â”‚ â”‚

â”‚ â”œâ”€ else: â”‚

â”‚ â”‚ ê·œì¹™ #3: remoteê°€ ë¡œì»¬ì˜ ìƒìœ„ì§‘í•©? â”‚

â”‚ â”‚ remote.fork_hash == fork_hash â†’ return true â”‚

â”‚ â”‚ â”‚

â”‚ â””â”€ if fork_hash == self.fork_hash: â”‚

â”‚ is_subset = false (ì´ì œë¶€í„° ë¯¸ë˜ ìƒíƒœ ê²€ì‚¬) â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 5. ê·œì¹™ #4: ëª¨ë“  ê²€ì‚¬ ì‹¤íŒ¨ â”‚

â”‚ â†’ return false â”‚

â”‚ "Local or remote needs software update" â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

  

### EIP-2124 ê²€ì¦ ê·œì¹™ ìƒì„¸ (ì‹¤ì œ ì½”ë“œ)

  

**head ê°’ ê²°ì • ë¡œì§**

  

```rust

// crates/common/types/fork_id.rs:80-85

// TIMESTAMP_THRESHOLD = 1438269973 (Ethereum Genesis íƒ€ì„ìŠ¤íƒ¬í”„ ê·¼ì²˜)

let head = if head_timestamp >= TIMESTAMP_THRESHOLD {

head_timestamp // PoS ëª¨ë“œ: íƒ€ì„ìŠ¤íƒ¬í”„ ì‚¬ìš©

} else {

latest_block_number // PoW ëª¨ë“œ: ë¸”ë¡ ë²ˆí˜¸ ì‚¬ìš©

};

```

  

**ê·œì¹™ #1: fork_hash ì¼ì¹˜**

  

```rust

// crates/common/types/fork_id.rs:87-94

if remote.fork_hash == self.fork_hash {

// validation rule #1

if remote.fork_next <= head && remote.fork_next != 0 {

debug!("Future fork already passed locally.");

return false;

}

return true;

}

```

  

```

ë¡œì»¬ê³¼ ì›ê²©ì˜ fork_hashê°€ ë™ì¼í•œ ê²½ìš°:

- ë‘ ë…¸ë“œê°€ ë™ì¼í•œ í¬í¬ íˆìŠ¤í† ë¦¬ë¥¼ ê²½í—˜í•¨

- fork_nextë§Œ ê²€ì¦í•˜ë©´ ë¨

- remote.fork_nextê°€ ì´ë¯¸ ì§€ë‚˜ê°„ í¬í¬ë¥¼ ê°€ë¦¬í‚¤ë©´ â†’ ê±°ë¶€

- ê·¸ ì™¸ â†’ í—ˆìš©

```

  

**ê·œì¹™ #2: ì›ê²©ì´ ë¶€ë¶„ì§‘í•© (ê³¼ê±° ìƒíƒœ)**

  

```rust

// crates/common/types/fork_id.rs:101-106

for (fork_hash, fork_next) in valid_combinations {

if is_subset {

// The remote hash is a subset of the local past forks (rule #2)

if remote.fork_hash == fork_hash && remote.fork_next == fork_next {

return true;

}

}

// ...

}

```

  

```

ì›ê²© ë…¸ë“œê°€ ë¡œì»¬ë³´ë‹¤ ê³¼ê±° ìƒíƒœì¸ ê²½ìš°:

- ì›ê²©ì˜ fork_hashê°€ ë¡œì»¬ì˜ ê³¼ê±° fork_hashì™€ ì¼ì¹˜

- ì›ê²©ì˜ fork_nextë„ í•´ë‹¹ ì‹œì ì˜ fork_nextì™€ ì¼ì¹˜í•´ì•¼ í•¨

- ë™ê¸°í™”ë¥¼ í†µí•´ ë”°ë¼ì¡ì„ ìˆ˜ ìˆìŒ â†’ í—ˆìš©

```

  

**ê·œì¹™ #3: ì›ê²©ì´ ìƒìœ„ì§‘í•© (ë¯¸ë˜ ìƒíƒœ)**

  

```rust

// crates/common/types/fork_id.rs:107-117

for (fork_hash, fork_next) in valid_combinations {

// ...

} else {

// The remote hash is a superset of the local past forks (rule #3)

if remote.fork_hash == fork_hash {

return true;

}

}

if fork_hash == self.fork_hash {

// From this point on, if we have a match, it means the remote fork hash

// is a superset of our local past forks.

is_subset = false;

}

}

```

  

```

ì›ê²© ë…¸ë“œê°€ ë¡œì»¬ë³´ë‹¤ ë¯¸ë˜ ìƒíƒœì¸ ê²½ìš°:

- is_subsetì´ falseë¡œ ì „í™˜ëœ í›„ (ë¡œì»¬ fork_hashë¥¼ ì§€ë‚œ í›„)

- ì›ê²©ì˜ fork_hashê°€ ë¡œì»¬ì˜ ë¯¸ë˜ fork_hashì™€ ì¼ì¹˜

- fork_nextëŠ” ê²€ì¦í•˜ì§€ ì•ŠìŒ (ë¯¸ë˜ ìƒíƒœì´ë¯€ë¡œ)

- ë¡œì»¬ì´ ì†Œí”„íŠ¸ì›¨ì–´ ì—…ë°ì´íŠ¸ í›„ ë”°ë¼ê°ˆ ìˆ˜ ìˆìŒ â†’ í—ˆìš©

```

  

**ê·œì¹™ #4: í˜¸í™˜ ë¶ˆê°€**

  

```rust

// crates/common/types/fork_id.rs:119-121

// rule #4

debug!("Local or remote needs software update.");

false

```

  

```

ìœ„ 3ê°€ì§€ ê·œì¹™ ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²½ìš°:

- ë‹¤ë¥¸ ì²´ì¸ì´ê±°ë‚˜ ì™„ì „íˆ ë‹¤ë¥¸ í¬í¬ ê²½ë¡œ

- valid_combinations ì „ì²´ë¥¼ ìˆœíšŒí•´ë„ ì¼ì¹˜í•˜ëŠ” ì¡°í•©ì´ ì—†ìŒ

- "Local or remote needs software update" â†’ ê±°ë¶€

```

  

---

  

## í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ë¶„ì„

  

### í…ŒìŠ¤íŠ¸ êµ¬ì¡°ì²´

  

```rust

struct TestCase {

head: u64, // í…ŒìŠ¤íŠ¸í•  ë¸”ë¡ ë²ˆí˜¸

time: u64, // í…ŒìŠ¤íŠ¸í•  íƒ€ì„ìŠ¤íƒ¬í”„

fork_id: ForkId,// ê²€ì¦í•  Fork-ID ê°’

is_valid: bool, // ì˜ˆìƒ ê²°ê³¼ (í˜¸í™˜ì„± ì—¬ë¶€)

}

```

  

### assert_test_cases í•¨ìˆ˜

  

```rust

fn assert_test_cases(

test_cases: Vec<TestCase>,

chain_config: ChainConfig,

genesis_header: BlockHeader

) {

for test_case in test_cases {

// 1. ë¡œì»¬ Fork-ID ìƒì„±

let fork_id = ForkId::new(

chain_config,

genesis_header.clone(),

test_case.time, // íƒ€ì„ìŠ¤íƒ¬í”„

test_case.head // ë¸”ë¡ ë²ˆí˜¸

);

  

// 2. is_valid í˜¸ì¶œí•˜ì—¬ ê²€ì¦

assert_eq!(

fork_id.is_valid(

test_case.fork_id, // í…ŒìŠ¤íŠ¸í•  ì›ê²© Fork-ID

test_case.head,

test_case.time,

chain_config,

genesis_header.clone()

),

test_case.is_valid // ì˜ˆìƒ ê²°ê³¼ì™€ ë¹„êµ

)

}

}

```

  

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íë¦„

  

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ mainnet_test_cases() í…ŒìŠ¤íŠ¸ ì‹œì‘ â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 1. Genesis íŒŒì¼ ë¡œë“œ â”‚

â”‚ genesis.json â†’ Genesis êµ¬ì¡°ì²´ â”‚

â”‚ genesis.get_block().header â†’ BlockHeader â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 2. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë°°ì—´ ìƒì„± â”‚

â”‚ vec![ â”‚

â”‚ TestCase { head: 0, time: 0, fork_id: {...}, ... }, â”‚

â”‚ TestCase { head: 1149999, ... }, â”‚

â”‚ ... â”‚

â”‚ ] â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 3. assert_test_cases() í˜¸ì¶œ â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ ê° TestCaseì— ëŒ€í•´ ë°˜ë³µ â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â–¼ â–¼ â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ TestCase 1 â”‚ â”‚ TestCase 2 â”‚ â”‚ TestCase N â”‚

â”‚ head: 0 â”‚ â”‚ head: ... â”‚ â”‚ head: ... â”‚

â”‚ time: 0 â”‚ â”‚ time: ... â”‚ â”‚ time: ... â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚ â”‚ â”‚

â–¼ â–¼ â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 4. ForkId::new() í˜¸ì¶œ â”‚

â”‚ ì…ë ¥: chain_config, genesis_header, time, head â”‚

â”‚ ì¶œë ¥: ë¡œì»¬ Fork-ID (fork_hash, fork_next) â”‚

â”‚ â”‚

â”‚ ë‚´ë¶€ ë™ì‘: â”‚

â”‚ - CRC32 í•´ì…” ì´ˆê¸°í™” (genesis_hashë¡œ) â”‚

â”‚ - ë¸”ë¡/íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ í¬í¬ë“¤ì„ ìˆœíšŒ â”‚

â”‚ - head/timeê¹Œì§€ í™œì„±í™”ëœ í¬í¬ë“¤ì„ CRC32ì— ëˆ„ì  â”‚

â”‚ - ë‹¤ìŒ í¬í¬ ë²ˆí˜¸ë¥¼ fork_nextë¡œ ì„¤ì • â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 5. is_valid() í˜¸ì¶œ â”‚

â”‚ ì…ë ¥: test_case.fork_id (ê²€ì¦ ëŒ€ìƒ) â”‚

â”‚ ì¶œë ¥: bool (í˜¸í™˜ ì—¬ë¶€) â”‚

â”‚ â”‚

â”‚ ë‚´ë¶€ ë™ì‘: â”‚

â”‚ - EIP-2124ì˜ 4ê°€ì§€ ê·œì¹™ ìˆœì°¨ ì ìš© â”‚

â”‚ - ê·œì¹™ #1: fork_hash ì¼ì¹˜ ê²€ì‚¬ â”‚

â”‚ - ê·œì¹™ #2: ë¶€ë¶„ì§‘í•© ê²€ì‚¬ (ê³¼ê±° ìƒíƒœ) â”‚

â”‚ - ê·œì¹™ #3: ìƒìœ„ì§‘í•© ê²€ì‚¬ (ë¯¸ë˜ ìƒíƒœ) â”‚

â”‚ - ê·œì¹™ #4: ëª¨ë‘ ì‹¤íŒ¨ ì‹œ false â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚

â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ 6. assert_eq!() ê²€ì¦ â”‚

â”‚ is_valid() ê²°ê³¼ == test_case.is_valid â”‚

â”‚ â†’ ì¼ì¹˜: í…ŒìŠ¤íŠ¸ í†µê³¼ â”‚

â”‚ â†’ ë¶ˆì¼ì¹˜: í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (panic) â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

  

### Mainnet í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ê²€ì¦ ì˜ˆì‹œ

  

**ì˜ˆì‹œ 1: Genesis (ë¸”ë¡ 0)**

```

ì…ë ¥:

head = 0

time = 0

test_fork_id = { hash: 0xfc64ec04, next: 1150000 }

  

ForkId::new() ì‹¤í–‰:

- hasher.update(genesis_hash)

- ë‹¤ìŒ í¬í¬ = 1150000 (Homestead)

- fork_hash = CRC32(genesis_hash) = 0xfc64ec04

- fork_next = 1150000

  

is_valid() ì‹¤í–‰:

- ê·œì¹™ #1: fork_hash ì¼ì¹˜ (0xfc64ec04 == 0xfc64ec04)

- fork_next ê²€ì¦: 1150000 > head(0) â†’ OK

- return true

  

ê²°ê³¼: true == test_case.is_valid(true) â†’ í†µê³¼

```

  

**ì˜ˆì‹œ 2: Homestead í™œì„±í™” (ë¸”ë¡ 1,150,000)**

```

ì…ë ¥:

head = 1150000

time = 0

test_fork_id = { hash: 0x97c2c34c, next: 1920000 }

  

ForkId::new() ì‹¤í–‰:

- hasher.update(genesis_hash)

- í¬í¬ 1150000 <= head â†’ hasher.update(1150000)

- ë‹¤ìŒ í¬í¬ = 1920000 (DAO)

- fork_hash = CRC32(genesis_hash + 1150000) = 0x97c2c34c

- fork_next = 1920000

  

is_valid() ì‹¤í–‰:

- ê·œì¹™ #1: fork_hash ì¼ì¹˜ (0x97c2c34c == 0x97c2c34c)

- fork_next ê²€ì¦: 1920000 > head(1150000) â†’ OK

- return true

  

ê²°ê³¼: true == test_case.is_valid(true) â†’ í†µê³¼

```

  

**ì˜ˆì‹œ 3: Shanghai í™œì„±í™” (íƒ€ì„ìŠ¤íƒ¬í”„ 1681338455)**

```

ì…ë ¥:

head = 20000000 (ë¬´ì‹œë¨)

time = 1681338455

test_fork_id = { hash: 0xdce96c2d, next: 1710338135 }

  

ForkId::new() ì‹¤í–‰:

- hasher.update(genesis_hash)

- ëª¨ë“  ë¸”ë¡ ê¸°ë°˜ í¬í¬ ì²˜ë¦¬ ì™„ë£Œ (fork_next = 0)

- íƒ€ì„ìŠ¤íƒ¬í”„ í¬í¬ ì²˜ë¦¬ ì‹œì‘

- 1681338455 <= time â†’ hasher.update(1681338455)

- ë‹¤ìŒ í¬í¬ = 1710338135 (Cancun)

- fork_hash = 0xdce96c2d

- fork_next = 1710338135

  

is_valid() ì‹¤í–‰:

- head ê²°ì •: time >= TIMESTAMP_THRESHOLD â†’ head = 1681338455

- ê·œì¹™ #1: fork_hash ì¼ì¹˜

- fork_next ê²€ì¦: 1710338135 > head(1681338455) â†’ OK

- return true

  

ê²°ê³¼: true == test_case.is_valid(true) â†’ í†µê³¼

```

  

---

  

**Document Type:** Technical Research Paper

**Version:** 1.0

**Depth Level:** Advanced

**Target Audience:** Ethereum Protocol Developers, L1/L2 Engineers

**Date:** 2026-02-04